"use strict";(self.webpackChunknotion_next=self.webpackChunknotion_next||[]).push([[5008],{54428:(e,t,i)=>{i.r(t),i.d(t,{default:()=>y});var o=i(77094),n=i.n(o),s=i(67294),r=i(83355),a=i(3779),l=i(5366),c=i(24677),d=i(98104),u=i(33846),h=i(37601),m=i(21199),p=i(1743),b=i(74194);class g extends r.Z{constructor(){super(...arguments),this.storeTypes={store:u.Z},this.handleFocused=()=>{c.ZH(this.environment),d.ZH(this.environment),this.stores.store.setState({...this.stores.store.state,focus:!0})},this.handleBlurred=()=>{this.stores.store.setState({...this.stores.store.state,focus:!1})},this.handleSearchQueryChange=e=>{this.props.onChange({searchQuery:e.target.value})}}renderComponent(){const{searchQuery:e,intl:t}=this.props,{focus:i}=this.stores.store.state;return n()(p.Z,{capture:i},void 0,n()(m.Z,{capture:!0,render:o=>s.createElement("div",o,n()(b.Z,{style:this.getStyle(),format:b.B.Transparent,value:e,placeholder:t.formatMessage({defaultMessage:"Type to searchâ€¦",id:"database.mobileSearch.placeholder"}),onChange:this.handleSearchQueryChange,autoComplete:"on",autoCorrect:"on",onFocus:this.handleFocused,onBlur:this.handleBlurred,showClearButton:!0,left:a.Z.searchThick(this.getSearchIconStyle())}),n()(h.Z,{show:i}))}))}getStyle(){return{boxShadow:this.theme.inputBoxShadow,background:this.theme.inputBackground,flexGrow:0,flexShrink:0,height:32,paddingLeft:8,paddingRight:12,borderRadius:3,fontSize:14,marginBottom:4}}getSearchIconStyle(){return{width:14,height:14,marginRight:6,flexGrow:0,flexShrink:0,fill:this.theme.mediumIconColor}}}g.displayName="CollectionMobileSearch";const y=(0,l.injectIntl)(g)},44299:(e,t,i)=>{i.r(t),i.d(t,{default:()=>V});var o=i(97464),n=i.n(o),s=i(77094),r=i.n(s),a=i(96486),l=i.n(a),c=i(67294),d=i(83355),u=i(13991),h=i(41432),m=i(3779),p=i(82990),b=i(5366),g=i(50906),y=i(44886),S=i(55332),f=i(24677),v=i(98104),k=i(67074),T=i(59488),A=i(52533),M=i(68056),C=i(72133),x=i(17903),I=i(72653),w=i(69454),B=i(27724),P=i(24666),Z=i(64921),R=i(1892),N=i(44532),F=i(64131),_=i(82945),D=i(85394),U=i(40464),O=i(32404),q=i(73383);class E extends d.Z{constructor(){super(...arguments),this.scrollerDiv=void 0,this.currentlyShownTimer=void 0,this.previouslyShownOnNative=!1,this.handleScrollerRef=e=>{e&&(this.scrollerDiv=e)},this.handleUnindent=e=>{k.$$(this.environment)},this.handleIndent=e=>{k.O2(this.environment)},this.handleMoveUp=e=>{k.s0(this.environment)},this.handleMoveDown=e=>{k.rZ(this.environment)},this.handleUndo=()=>{k.i2(this.environment)},this.handleRedo=()=>{k.GH(this.environment)},this.handleDismissKeyboard=e=>{f.ZH(this.environment),this.props.stores.store.setState({...this.props.stores.store.state,isInsertOpen:!1}),this.trackItemTap("hide_keyboard"),v.sD()},this.handleInsert=e=>{this.props.stores.store.setState({...this.props.stores.store.state,isInsertOpen:!0}),this.trackItemTap("insert")},this.handleTakePicture=e=>{k.vs(this.environment)},this.handleMention=e=>{k.Z3(this.environment)},this.handleComment=e=>{k.ol(this.environment,!1,"mobile_action_bar")},this.handleDelete=e=>{k.fn(this.environment)},this.handleActionsScroll=()=>{g.FGU(this.environment)},this.handleActionsScrollDebounced=l().debounce(this.handleActionsScroll,500),this.handleMoreClick=e=>{k.w1(this.environment,e.clientX,e.clientY)},this.listenForPositionChanges=this.createComputedStore((()=>{const e=P.default.state;if("editing"===e.mode){const t=e.multiSelection.end;return{scrollTop:x.Z.state.scrollTop,editing:!0,store:t.store.id,selection:t}}return{scrollTop:x.Z.state.scrollTop,editing:!1}})),this.renderStore=this.createComputedStore((()=>{var e;return k.$3(this.environment,this.props.currentBlockStore,null===(e=this.pageContext)||void 0===e?void 0:e.publicEditModeStore.state)})),this.shouldShowTextActions=this.createComputedStore((()=>k.oQ(this.props.stores.ignoreSelectionAreaStore,this.environment.TextSelectionCompositionStore))),this.canTriggerBlockActions=this.createComputedStore((()=>!this.shouldShowTextActions.state&&k.Bo(this.pageContext&&this.pageContext.publicEditModeStore.state))),this.canTriggerTextActions=this.createComputedStore((()=>k.eQ(this.pageContext&&this.pageContext.publicEditModeStore.state,this.props.currentBlockStore))),this.hasMultiBlockSelection=this.createComputedStore((()=>{const e=P.default.state;return"editing"===e.mode&&!(0,M.qS)(e.multiSelection)}))}willMountOrUpdate(){const{device:e}=this.environment,t=this.renderStore.state.shouldShow;if(e.isMobileBrowser){const e=this.props.stores.store.state.isOpen;t?e?void 0!==this.currentlyShownTimer&&(window.clearTimeout(this.currentlyShownTimer),this.currentlyShownTimer=void 0):(this.props.stores.store.setState({...this.props.stores.store.state,isOpen:!0}),this.scrollerDiv&&(this.scrollerDiv.scrollLeft=0)):e&&void 0===this.currentlyShownTimer&&(this.currentlyShownTimer=window.setTimeout((()=>{this.currentlyShownTimer=void 0,this.props.stores.store.setState({...this.props.stores.store.state,isOpen:!1})}),200))}else t!==this.previouslyShownOnNative&&(this.previouslyShownOnNative=t,this.scrollerDiv&&(this.scrollerDiv.scrollLeft=0))}renderComponent(){const{device:e,WindowSizeStore:t}=this.environment,i=this.isOpen(),o=e.isMobile&&I.Z.state;if(this.props.position===A.nd.Bottom){let e=0;return(0,T.Y)("supportsFixedSizeWebView")?e=w.Z.estimatedNativeWebBottomOverlap():o&&(e=t.getSafePaddingBottomCSS(D.default.height)),r()("div",{style:{position:"absolute",bottom:e,left:0,height:E.height,width:"100%",pointerEvents:i?"auto":"none",opacity:i?1:0,transform:i?"translateY(0)":`translateY(${E.height}px)`,transition:"opacity 120ms ease-out, transform 120ms ease-out"}},void 0,this.renderActionButtons())}{this.listenForPositionChanges.state;const e=this.props.stores.ignoreSelectionAreaStore.state.savedTextSelectionRect||C.getSelectionRect();if(!e)return;const t=document.body.getBoundingClientRect(),o={...e,left:10,top:e.top+10-t.top},{device:n}=this.environment;return r()(N.ZP,{popupType:n.isMobileNative?N.ZP.PopupType.SlideUp:N.ZP.PopupType.Popup,open:i,preventBlockRenderQueueOnEnter:!0,placementToOrigin:N.ZP.Placement.Bottom,alignmentToOrigin:N.ZP.Alignment.Start,originRect:o,disableMouseCapture:!0,keepFocus:!0,render:()=>r()("div",{style:{height:E.height,width:"calc(80wv)",borderRadius:3,overflow:"hidden"}},void 0,this.renderActionButtons())})}}renderActions(){return k.Tz({environment:this.environment,store:this.props.currentBlockStore})?this.renderTemplatesButton():this.shouldShowTextActions.state?this.renderTextActions():this.renderBlockActions()}renderActionButtons(){return r()("div",{style:this.getActionButtonStyles()},void 0,this.renderActions(),r()(Z.Z,{mobileFeedback:!0,disabledFeedback:!0,style:{...this.getItemStyle(),borderLeft:this.getItemBorder(),borderRight:"none"},onClick:this.handleDismissKeyboard},void 0,E.keyboardIcon))}renderBlockActions(){const e=this.canTriggerBlockActions.state;let t=!1,i=!1;const o=this.props.currentBlockStore.getType();if(o){const e=this.props.currentBlockStore.getFormat();(0,h._T)(o,e)||(t=!0),(0,h.lQ)(o)||(i=!0)}const{device:s}=this.environment;return c.createElement("div",{ref:this.handleScrollerRef,style:this.getActionMenuStyle(),onScroll:this.handleActionsScrollDebounced},r()(Z.Z,{mobileFeedback:!0,disabledFeedback:!0,style:{...this.getItemStyle(),...!s.isSmallPhone&&{paddingLeft:12,paddingRight:12}},onClick:this.handleInsert,disabled:!e},void 0,E.plusIcon,this.renderChevronDown()),r()(Z.Z,{mobileFeedback:!0,disabledFeedback:!0,style:{...this.getItemStyle(),fontWeight:p.Z.fontWeight.medium},onClick:e=>{this.props.stores.store.setState({...this.props.stores.store.state,isTurnIntoOpen:!0}),this.trackItemTap("turn_into")},disabled:!e},void 0,r()(b.FormattedMessage,{defaultMessage:"Turn into",id:"mobileActionBar.turnInto.buttonTitle"}),this.renderChevronDown()),r()(R.Z,{capture:!0,render:e=>c.createElement(Z.Z,n()({mobileFeedback:!0,disabledFeedback:!0},e,{style:this.getItemStyle(),onClick:this.handleMention,disabled:!i}),r()("span",{style:{fontSize:19,lineHeight:1,fontWeight:p.Z.fontWeight.medium,marginBottom:s.isAndroid?4:0}},void 0,"@"))}),r()(Z.Z,{mobileFeedback:!0,disabledFeedback:!0,style:this.getItemStyle(),onClick:this.handleComment,disabled:!t},void 0,E.discussionIcon),r()(Z.Z,{mobileFeedback:!0,disabledFeedback:!0,style:this.getItemStyle(),onClick:this.handleTakePicture,disabled:!e},void 0,E.imageIcon),r()(Z.Z,{mobileFeedback:!0,disabledFeedback:!0,style:this.getItemStyle(),onClick:this.handleDelete,disabled:!e},void 0,E.trashIcon),this.renderBlockMovementActions(),this.renderBlockUndoActions(),r()(Z.Z,{mobileFeedback:!0,disabledFeedback:!0,style:{...this.getItemStyle(),fontWeight:p.Z.fontWeight.medium},onClick:e=>{this.props.stores.store.setState({...this.props.stores.store.state,isColorOpen:!0}),this.trackItemTap("color")},disabled:!e},void 0,r()(b.FormattedMessage,{defaultMessage:"Color",id:"mobileActionBar.color.buttonTitle"}),this.renderChevronDown()),r()(Z.Z,{mobileFeedback:!0,disabledFeedback:!0,style:{...this.getItemStyle(),fontWeight:p.Z.fontWeight.medium},onClick:this.handleMoreClick,disabled:!e},void 0,r()(b.FormattedMessage,{defaultMessage:"More",id:"mobileActionBar.more.buttonTitle"}),this.renderChevronDown()))}renderBlockMovementActions(){const e=this.canTriggerBlockActions.state,t=B.default.state.stores[0];return r()("div",{style:{...this.getItemStyle(),paddingLeft:6,paddingRight:6}},void 0,r()(Z.Z,{mobileFeedback:!0,disabledFeedback:!0,style:E.minorItemStyle,disabled:!e||!y.gq(t),onClick:this.handleUnindent},void 0,E.unindentIcon),r()(Z.Z,{mobileFeedback:!0,disabledFeedback:!0,style:E.minorItemStyle,disabled:!e||!y.nt(t),onClick:this.handleIndent},void 0,E.indentIcon),r()(Z.Z,{mobileFeedback:!0,disabledFeedback:!0,style:E.minorItemStyle,disabled:!e,onClick:this.handleMoveUp},void 0,E.moveUpIcon),r()(Z.Z,{mobileFeedback:!0,disabledFeedback:!0,style:E.minorItemStyle,disabled:!e,onClick:this.handleMoveDown},void 0,E.moveDownIcon))}renderBlockUndoActions(){return r()("div",{style:{...this.getItemStyle(),paddingLeft:6,paddingRight:6}},void 0,r()(Z.Z,{mobileFeedback:!0,disabledFeedback:!0,style:E.minorItemStyle,disabled:!S.L0(),onClick:this.handleUndo},void 0,E.undoIcon),r()(Z.Z,{mobileFeedback:!0,disabledFeedback:!0,style:E.minorItemStyle,disabled:!S.AZ(),onClick:this.handleRedo},void 0,E.redoIcon))}renderTextActions(){const e=this.canTriggerTextActions.state,t=this.hasMultiBlockSelection.state,i=this.props.currentBlockStore.canComment(),o=B.default.state.stores[0],n={display:"flex",alignItems:"center",padding:"0 8px",whiteSpace:"nowrap"};return r()("div",{style:this.getActionMenuStyle(),onScroll:this.handleActionsScrollDebounced},void 0,r()(_.Z,{style:this.getItemStyle(),blockStore:B.default.state.stores[0],disabled:!i}),r()(U.Z,{type:"b",style:this.getItemStyle(),onClick:()=>this.trackItemTap("bold"),disabled:!e},void 0,r()("span",{style:{fontWeight:p.Z.fontWeight.semibold}},void 0,r()(b.FormattedMessage,{defaultMessage:"B",id:"mobileActionBar.bold.symbol",description:"Letter 'B' which represents 'bold' format option."}))),r()(U.Z,{type:"i",style:this.getItemStyle(),onClick:()=>this.trackItemTap("italic"),disabled:!e},void 0,r()("span",{style:{fontStyle:"italic",fontWeight:p.Z.fontWeight.semibold}},void 0,r()(b.FormattedMessage,{defaultMessage:"i",id:"mobileActionBar.italic.symbol",description:"Letter 'i' which represents 'italic' format option."}))),r()(U.Z,{type:"_",style:this.getItemStyle(),onClick:()=>this.trackItemTap("underline"),disabled:!e},void 0,r()("span",{style:{textDecoration:"underline"}},void 0,r()(b.FormattedMessage,{defaultMessage:"U",id:"mobileActionBar.underline.symbol",description:"Letter 'U' which represents 'underline' format option."}))),r()(U.Z,{type:"s",style:this.getItemStyle(),onClick:()=>this.trackItemTap("strike_through"),disabled:!e},void 0,r()("span",{style:{textDecoration:"line-through"}},void 0,r()(b.FormattedMessage,{defaultMessage:"S",id:"mobileActionBar.strikeThrough.symbol",description:"Letter 'S' which represents 'strike-through' format option."}))),r()(Z.Z,{mobileFeedback:!0,disabledFeedback:!0,style:n,disabled:!y.gq(o),onClick:this.handleUnindent},void 0,E.unindentIcon),r()(Z.Z,{mobileFeedback:!0,disabledFeedback:!0,style:{...n,borderRight:this.getItemBorder()},disabled:!y.nt(o),onClick:this.handleIndent},void 0,E.indentIcon),r()(U.Z,{type:"c",style:this.getItemStyle(),onClick:()=>this.trackItemTap("code"),disabled:!e},void 0,r()("span",{style:{fontFamily:p.Z.getCompositeFontFamily(u.SP).githubMono}},void 0,r()(b.FormattedMessage,{defaultMessage:"Code",id:"mobileActionBar.code.symbol",description:"Word 'code' which represents 'code' format option."}))),r()(q.Z,{style:this.getItemStyle(),disabled:!e||t},void 0,r()("span",{style:{borderBottom:`1px solid ${this.theme.linkDecorationColor}`}},void 0,r()(b.FormattedMessage,{defaultMessage:"Link",id:"mobileActionBar.link.symbol",description:"Word 'link' which represents 'link' format option."}))),r()(O.Z,{onClick:()=>this.trackItemTap("equation"),disabled:!e||t,style:this.getItemStyle()},void 0,m.Z.equation({width:16,height:16})),r()(F.Z,{style:this.getItemStyle(),ignoreSelectionAreaStore:this.props.stores.ignoreSelectionAreaStore,disabled:!e}))}renderTemplatesButton(){return r()("div",{style:this.getActionMenuStyle()},void 0,r()(Z.Z,{mobileFeedback:!0,disabledFeedback:!0,style:{...this.getItemStyle(),borderRight:"none",fontWeight:p.Z.fontWeight.medium},onClick:e=>{this.props.stores.store.setState({...this.props.stores.store.state,isTemplatesOpen:!0}),this.trackItemTap("templates")}},void 0,m.Z.templatesColor({width:20,marginRight:8}),r()(b.FormattedMessage,{defaultMessage:"Choose a template...",id:"mobileActionBar.templates.buttonTitle"}),this.renderChevronDown()))}renderChevronDown(){return m.Z.chevronDown({width:10,marginLeft:4,fill:this.theme.lightIconColor})}isOpen(){const{device:e}=this.environment;return e.isMobileBrowser?this.props.stores.store.state.isOpen:this.renderStore.state.shouldShow}trackItemTap(e){g.YOV(this.environment,{itemName:e})}getItemBorder(){return`1px solid ${this.theme.regularDividerColor}`}getActionButtonStyles(){const{device:e,WindowSizeStore:t}=this.environment;return{height:"100%",width:"100%",fontSize:15,display:"flex",boxShadow:this.props.position===A.nd.Bottom?this.theme.bottomActionBarShadow:this.theme.mediumBoxShadow,backgroundColor:this.theme.keyboardActionBarBackground,paddingLeft:e.isMobileNative?t.state.paddingLeftCSS:0,paddingRight:e.isMobileNative?t.state.paddingRightCSS:0}}getActionMenuStyle(){return{flexGrow:1,flexShrink:1,marginRight:-1,display:"flex",overflowX:"auto",overflowY:"hidden",WebkitOverflowScrolling:"touch"}}getItemStyle(){const{device:e}=this.environment;return{display:"flex",alignItems:"center",justifyContent:"center",paddingLeft:e.isSmallPhone?8:10,paddingRight:e.isSmallPhone?8:10,borderRight:this.getItemBorder(),whiteSpace:"nowrap",height:E.height,flexShrink:0,flexGrow:0,flexBasis:"auto",color:this.theme.regularTextColor,minWidth:e.isSmallPhone?42:44}}}E.displayName="MobileActionBar",E.unindentIcon=m.Z.indentDown({width:18,height:18,transform:"rotate(90deg)",position:"relative",left:1}),E.indentIcon=m.Z.indentDown({width:18,height:18,transform:"rotate(-90deg)",position:"relative",left:-1}),E.moveUpIcon=m.Z.moveUp({width:18,height:18,position:"relative",left:2}),E.moveDownIcon=m.Z.moveUp({width:18,height:18,transform:"rotate(180deg)",position:"relative",left:2}),E.undoIcon=m.Z.undo({width:19,height:19}),E.redoIcon=m.Z.redo({width:19,height:19}),E.trashIcon=m.Z.trash({width:18,height:18}),E.discussionIcon=m.Z.speechBubbleThin({width:18,height:18}),E.plusIcon=m.Z.thinPlus({width:14,height:14}),E.keyboardIcon=m.Z.keyboard({width:18,height:18}),E.imageIcon=m.Z.image({width:18,height:18}),E.height=42,E.minorItemStyle={width:34,justifyContent:"center"};const V=(0,b.injectIntl)(E)},82043:(e,t,i)=>{i.r(t),i.d(t,{default:()=>O});var o=i(97464),n=i.n(o),s=i(77094),r=i.n(s),a=i(67294),l=i(83355),c=i(10482),d=i(51454),u=i(5366),h=i(95182),m=i(50906),p=i(88428),b=i(21325),g=i(60709),y=i(67074),S=i(94660),f=i(27832),v=i(63334),k=i(29798),T=i(49085);class A extends T.default{getInitialState(){return{isOpen:!1,isInsertOpen:!1,isTurnIntoOpen:!1,isColorOpen:!1,isTemplatesOpen:!1}}}const M=A;var C=i(27724),x=i(24666),I=i(48019),w=i(56940),B=i(1892),P=i(78140),Z=i(9342),R=i(40721),N=i(44532),F=i(72495),_=i(40698),D=i(34574);class U extends l.Z{constructor(){super(...arguments),this.storeTypes={store:M,ignoreSelectionAreaStore:v.Z,templatePickerMenuListStore:k.Z},this.templatePreviewSectionsStore=this.createComputedStore((()=>{var e,t,i;return Object.entries((0,S.it)({userPersona:null===(e=f.default.state.currentUserSettingsStore)||void 0===e||null===(t=e.getSettings())||void 0===t?void 0:t.persona,subscriptionTier:null===(i=f.default.state.currentSpaceStore)||void 0===i?void 0:i.getSubscriptionTier()})).map((e=>{let[t,i]=e;return{key:t,render:e=>r()(F.Z,{title:a.createElement(u.FormattedMessage,c._5[t])},t,e.children),items:i.map(this.renderMobileTemplatePreviewItem)}}))})),this.renderMobileTemplatePreviewItem=e=>({key:e.name,render:t=>a.createElement(D.Z,n()({},t,{key:e.name,title:e.name,type:"page_template",format:"phone-modal",locked:!1})),action:()=>{p.$7({environment:this.environment,item:e,createNewPage:!1,isPrivate:!1})}}),this.renderPageTemplatePickerItem=e=>{const t=this.props.currentBlockStore;return{key:e.name,render:t=>{var i;return a.createElement(D.Z,n()({},t,{key:e.name,format:"phone-modal",title:e.name,type:e.type,icon:null===(i=e.iconFn)||void 0===i?void 0:i.call(e,this.getIconStyle(e)),locked:!1}))},action:i=>{t&&b.M_(this.environment)&&(m.rNQ(this.environment,{template_name:e.name,is_keyboard:"keydown"===i.event.type}),e.onClick(this.environment,t))}}},this.handleCloseColorPopup=()=>{this.stores.store.setState({...this.stores.store.state,isColorOpen:!1})},this.handleCloseInsertPopup=()=>{this.stores.store.setState({...this.stores.store.state,isInsertOpen:!1})},this.handleCloseTurnIntoPopup=()=>{this.stores.store.setState({...this.stores.store.state,isTurnIntoOpen:!1})},this.handleCloseTemplatesPopup=()=>{this.stores.store.setState({...this.stores.store.state,isTemplatesOpen:!1})},this.renderStore=this.createComputedStore((()=>{var e;return y.$3(this.environment,this.props.currentBlockStore,null===(e=this.pageContext)||void 0===e?void 0:e.publicEditModeStore.state)}))}renderComponent(){const{device:e,WindowSizeStore:t}=this.environment,i=this.isOpen(),{makeActionBarComponent:o}=this.props;return r()(a.Fragment,{},void 0,r()(B.Z,{capture:!0,render:e=>a.createElement("div",n()({},e,{style:{position:"relative",width:"100%",height:0,zIndex:d.Eo}}),o(this.stores),this.renderNativeMenuIgnoreSelectionArea(),this.renderInsertPopup(),this.renderTurnIntoPopup(),this.renderColorPopup(),this.renderTemplatesPopup())}),!i&&e.isIPhoneX&&e.isNative&&r()("div",{style:{position:"absolute",bottom:0,background:"transparent",height:t.state.paddingBottomCSS,width:"100%",pointerEvents:"none",WebkitUserSelect:"none"}}))}renderNativeMenuIgnoreSelectionArea(){const e=this.environment.NativeMobileActionBarStore;return e?r()(w.Z,{store:this.stores.ignoreSelectionAreaStore,capture:y.y6(this.environment),ignoreBlockSelection:!1,focusOffscreenInput:!1,restoreSelection:"editing"!==x.default.state.mode&&e.state.shouldRestoreSelectionForMenu,render:e=>null}):null}renderInsertPopup(){const{device:e}=this.environment;return r()(w.Z,{capture:this.stores.store.state.isInsertOpen,ignoreBlockSelection:!1,focusOffscreenInput:!1,restoreSelection:!1,render:t=>r()(N.ZP,{popupType:e.isMobile?N.ZP.PopupType.SlideUp:N.ZP.PopupType.Popup,preventBlockRenderQueueOnEnter:!0,open:this.stores.store.state.isInsertOpen,keepFocus:!0,onDismiss:()=>{t(),this.handleCloseInsertPopup()},render:()=>r()(P.Z,{menuType:g.og.Modal,title:r()(u.FormattedMessage,{defaultMessage:"Insert block",id:"mobileActionBar.insertBlock.modalTitle"}),right:r()(R.CancelMenuText,{}),onClickRight:()=>{t(),this.handleCloseInsertPopup()}},void 0,r()(I.Z,{sections:h.wg.state.insertActions,context:{environment:this.environment,blocks:C.default.state.stores,publicEditMode:void 0},onAccept:this.handleCloseInsertPopup}))})})}renderTurnIntoPopup(){const{device:e}=this.environment;return r()(w.Z,{capture:this.stores.store.state.isTurnIntoOpen,ignoreBlockSelection:!1,focusOffscreenInput:!1,restoreSelection:!0,render:()=>r()(N.ZP,{popupType:e.isMobile?N.ZP.PopupType.SlideUp:N.ZP.PopupType.Popup,open:this.stores.store.state.isTurnIntoOpen,keepFocus:!0,onDismiss:this.handleCloseTurnIntoPopup,preventBlockRenderQueueOnEnter:!0,render:()=>r()(P.Z,{menuType:g.og.Modal,title:r()(u.FormattedMessage,{defaultMessage:"Turn into",id:"mobileActionBar.turnInto.modalTitle"}),right:r()(R.CancelMenuText,{}),onClickRight:this.handleCloseTurnIntoPopup},void 0,r()(I.Z,{sections:[{...h.gH,title:""}],context:{environment:this.environment,blocks:C.default.state.stores,publicEditMode:void 0},onAccept:this.handleCloseTurnIntoPopup}))})})}renderColorPopup(){const{device:e}=this.environment;return r()(w.Z,{capture:this.stores.store.state.isColorOpen,ignoreBlockSelection:!1,focusOffscreenInput:!1,restoreSelection:!0,render:()=>r()(N.ZP,{popupType:e.isMobile?N.ZP.PopupType.SlideUp:N.ZP.PopupType.Popup,open:this.stores.store.state.isColorOpen,keepFocus:!0,onDismiss:this.handleCloseColorPopup,preventBlockRenderQueueOnEnter:!0,render:()=>r()(P.Z,{menuType:g.og.Modal,title:r()(u.FormattedMessage,{defaultMessage:"Block color",id:"mobileActionBar.blockColor.modalTitle"}),right:r()(R.CancelMenuText,{}),onClickRight:this.handleCloseColorPopup},void 0,r()(I.Z,{sections:[h.te,h.rz,h.Vm],context:{environment:this.environment,blocks:C.default.state.stores,publicEditMode:void 0},onAccept:this.handleCloseColorPopup}))})})}renderTemplatesPopup(){const{device:e}=this.environment;return r()(w.Z,{capture:this.stores.store.state.isTemplatesOpen,ignoreBlockSelection:!1,focusOffscreenInput:!1,restoreSelection:!1,render:()=>r()(N.ZP,{popupType:e.isMobile?N.ZP.PopupType.SlideUp:N.ZP.PopupType.Popup,open:this.stores.store.state.isTemplatesOpen,keepFocus:!0,render:()=>r()(P.Z,{menuType:g.og.Modal,title:r()(u.FormattedMessage,{defaultMessage:"Templates",id:"mobileActionBar.templates.modalTitle"}),right:r()(R.CancelMenuText,{}),onClickRight:this.handleCloseTemplatesPopup},void 0,r()(Z.Z,{type:Z.i.Vertical,store:this.stores.templatePickerMenuListStore,initialFocus:void 0,disableInitialScroll:!0,disableCommandEnter:!0,onAccept:this.handleCloseTemplatesPopup,sections:[{key:"Basic",render:e=>r()(F.Z,{},void 0,e.children),items:_.ss.map(this.renderPageTemplatePickerItem)},{key:"Database",render:e=>r()(F.Z,{title:r()(u.FormattedMessage,{defaultMessage:"Database",id:"mobileActionBar.databaseSection.title"})},void 0,e.children),items:_.Im.filter((e=>e.shouldShow(this.environment))).map(this.renderPageTemplatePickerItem)},...this.templatePreviewSectionsStore.state]}))})})}isOpen(){const{device:e}=this.environment;return e.isMobileBrowser?this.stores.store.state.isOpen:this.renderStore.state.shouldShow}getIconStyle(e){return e.isLargeDatabaseIcon?{width:16,fill:this.theme.regularIconColor,marginLeft:4,marginRight:4}:{width:20,fill:this.theme.regularIconColor,marginLeft:2,marginRight:2}}}U.displayName="MobileActionBarWrapper";const O=(0,u.injectIntl)(U)},85394:(e,t,i)=>{i.r(t),i.d(t,{default:()=>v});var o=i(77094),n=i.n(o),s=i(67294),r=i(83355),a=i(3779),l=i(51454),c=i(50906),d=i(55332),u=i(87531),h=i(74647),m=i(43250),p=i(59488),b=i(27832),g=i(72653),y=i(64921),S=i(79311);class f extends r.Z{constructor(){super(...arguments),this.handleClickFind=()=>{u.Kf({environment:this.environment,analyticsFrom:"mobile-bottom-bar"}),c.nBz(this.environment,{itemName:"search"})},this.handleClickQuickAdd=()=>{h.quickAddPage({environment:this.environment,from:"mobile_bottom_bar"}),c.nBz(this.environment,{itemName:"add_page"})},this.handleUndo=()=>{d.Yw(this.environment,!0),c.nBz(this.environment,{itemName:"undo"})},this.handleRedo=()=>{d.KX(this.environment,!0),c.nBz(this.environment,{itemName:"redo"})},this.canQuickAdd=this.createComputedStore((()=>Boolean(b.default.state.currentSpaceStore&&b.default.state.currentSpaceStore.canEdit())))}renderComponent(){const e=g.Z.state,t=(0,p.Y)("supportsNativeBottomBar"),{isTablet:i}=this.environment.device;if(e)return t?n()("div",{className:m.alX},void 0,this.renderUpdatesButton()):n()("div",{style:this.getWrapStyle(e),className:m.rKl},void 0,i?this.renderTabletButtons():this.renderPhoneButtons())}renderPhoneButtons(){return n()(s.Fragment,{},void 0,this.renderSearchButton(),this.renderUpdatesButton(),this.renderQuickAddPageButton())}renderTabletButtons(){return n()(s.Fragment,{},void 0,this.renderSearchButton(),this.renderUpdatesButton(),this.renderQuickAddPageButton(),this.renderUndoRedoButtons())}renderSearchButton(){return n()(y.Z,{style:this.getSearchButtonStyle(),onClick:this.handleClickFind,mobileFeedback:!0},void 0,a.Z.mobileBottomBarSearch(this.getIconStyle()))}renderUpdatesButton(){const{isTablet:e}=this.environment.device;return n()(S.Z,{format:e?S.Z.Format.MobileBottomBarTablet:S.Z.Format.MobileBottomBarPhone})}renderQuickAddPageButton(){return n()(y.Z,{style:this.getQuickAddButtonStyle(),onClick:this.handleClickQuickAdd,mobileFeedback:!0,disabled:!this.canQuickAdd.state,disabledFeedback:!0},void 0,a.Z.mobileBottomBarAddPage(this.getIconStyle()))}renderUndoRedoButtons(){return n()(s.Fragment,{},void 0,n()(y.Z,{style:this.getUndoButtonStyle(),onClick:this.handleUndo,mobileFeedback:!0,disabled:!d.L0(),disabledFeedback:!0},void 0,a.Z.mobileBottomBarUndo(this.getIconStyle())),n()(y.Z,{style:this.getRedoButtonStyle(),onClick:this.handleRedo,mobileFeedback:!0,disabled:!d.AZ(),disabledFeedback:!0},void 0,a.Z.mobileBottomBarRedo(this.getIconStyle())))}getWrapStyle(e){const{WindowSizeStore:t}=this.environment,{isTablet:i}=this.environment.device;return{position:"absolute",left:0,right:0,bottom:0,display:"flex",justifyContent:i?"flex-start":"space-around",height:t.getSafePaddingBottomCSS(f.height),paddingBottom:t.state.paddingBottomCSS,background:this.theme.contentBackground,borderTop:`1px ${this.theme.darkDividerColor} solid`,zIndex:l.D_,pointerEvents:e?"auto":"none",cursor:"pointer"}}getSearchButtonStyle(){const{WindowSizeStore:e}=this.environment,{isTablet:t}=this.environment.device;return{display:"flex",alignItems:"center",justifyContent:"flex-start",flex:1,paddingLeft:e.getSafePaddingLeftCSS(18),...t&&{flex:"none",paddingLeft:2,width:f.tabletButtonWidth,justifyContent:"center"}}}getQuickAddButtonStyle(){const{WindowSizeStore:e}=this.environment,{isTablet:t}=this.environment.device;return{display:"flex",alignItems:"center",justifyContent:"flex-end",flex:1,paddingRight:e.getSafePaddingRightCSS(18),...t&&{justifyContent:"center",flex:"none",paddingRight:0,width:f.tabletButtonWidth,marginRight:"auto"}}}getUndoButtonStyle(){const{WindowSizeStore:e}=this.environment;return{display:"flex",alignItems:"center",justifyContent:"flex-start",flex:"none",paddingLeft:e.getSafePaddingLeftCSS(18),width:f.tabletButtonWidth}}getRedoButtonStyle(){return{display:"flex",alignItems:"center",justifyContent:"center",flex:"none",width:f.tabletButtonWidth,paddingRight:4}}getIconStyle(){return{width:26,fill:this.theme.regularTextColor}}}f.displayName="MobileBottomBar",f.height=44,f.tabletButtonWidth=54;const v=f},56140:(e,t,i)=>{i.r(t),i.d(t,{default:()=>Q});var o=i(77094),n=i.n(o),s=i(96486),r=i.n(s),a=i(17126),l=i(67294),c=i(83355),d=i(49085),u=i(15145),h=i(32918),m=i(42875),p=i(3779),b=i(61784),g=i(89837),y=i(21202),S=i(5366),f=i(26797),v=i(49865),k=i(5978),T=i(30149),A=i(66213),M=i(40863),C=i(84210),x=i(60709);class I extends d.default{getInitialState(){return{}}}const w=I;var B=i(85057),P=i(13401),Z=i(75498),R=i(73063),N=i(78140),F=i(43765),_=i(40721),D=i(72495),U=i(78948),O=i(6695),q=i(82990),E=i(33929),V=i(65598),G=i(70464),L=i(19227),W=i(52275),j=i(16354),z=i(31278),$=i(76798);class H extends c.Z{constructor(){super(...arguments),this.renderProperty=e=>{const{schema:t,store:i,blockPropertyValueOverlayStore:o,collectionStore:s}=this.props;if(t[e])return n()(G.Z,{store:i,property:e,disabled:!0,locked:!1,format:L.Z.Format.Calendar,tableWrap:!1,blockPropertyValueOverlayStore:o,collectionStore:s},e)}}renderComponent(){const{time:e,store:t}=this.props,i=t.hasIcon()||!t.isEmptyPage(),o=t.hasError(),s=(0,C.ZP)({store:t,fullyQualified:!1,pageVisitSource:u.tY.LinkInPage}),r=V.Xp(t,{recursivelyLoadAllDiscussions:!1});return n()(j.Z,{href:s},void 0,n()(W.Z,{focused:!1,title:n()(l.Fragment,{},void 0,e&&n()("div",{style:{display:"flex",color:this.theme.mediumTextColor,fontSize:14,marginTop:8,marginBottom:6}},void 0,e),n()("div",{style:{display:"flex",alignItems:"center",...e&&{marginBottom:8}}},void 0,i&&!o&&n()(z.Z,{disabled:!0,icon:t.getIcon(),isEmptyPage:t.isEmptyPage(),size:24,style:{flexShrink:0,marginRight:8}}),o&&p.Z.warning({marginLeft:2,marginRight:10,width:20,fill:this.theme.accentColors.orange[500]}),n()($.ZP,{store:t,style:{fontWeight:q.Z.fontWeight.semibold}}),r>0&&n()("div",{style:{display:"flex",alignItems:"center",color:this.theme.regularDividerColor,fontSize:12,marginLeft:4,flexShrink:0}},void 0,p.Z.speechBubble({width:12,height:12,marginRight:4,fill:this.theme.mediumIconColor}),r))),caption:this.renderProperties()}))}renderProperties(){const{format:e,schema:t,store:i}=this.props,o=(e.calendar_properties?e.calendar_properties.filter((e=>e.visible)).map((e=>e.property)):[]).filter((e=>O.XU({block:i.getModel(),property:e,schema:t,getRecordModel:i.getRecordModel,userTimeZone:(0,m.r)(),intl:E.default.getIntl()})));if(o.length>0)return n()("div",{style:{marginTop:8}},void 0,o.map(this.renderProperty))}}H.displayName="MobileCalendarDayMenuItem";const K=H;class Y extends c.Z{constructor(){super(...arguments),this.storeTypes={store:w,resultStore:d.default.createClass(void 0)},this.renderResults=()=>{const{disabled:e,collectionContextStore:t}=this.props,i=t.collectionStore();if(!i)return;const o=this.getCurrentStartOfDay(),s=o.endOf("day"),r=this.getCurrentResults();return n()(N.Z,{menuType:x.og.Modal,title:n()("div",{style:Y.headerStyle},void 0,n()(R.Z,{onClick:this.handleLeftClick,icon:p.Z.chevronLeft,style:{marginRight:8,marginTop:2},mobileFeedback:!0}),n()("div",{},void 0,(0,b.ZW)(o,"month_day_long")),n()(R.Z,{onClick:this.handleRightClick,icon:p.Z.chevronRight,style:{marginLeft:8,marginTop:2},mobileFeedback:!0})),right:n()(_.DoneMenuText,{}),onClickRight:this.props.onDismiss},void 0,!r&&n()(D.Z,{},void 0,n()(U.Z,{})),r&&0===r.length&&n()(D.Z,{},void 0,n()(F.Z,{title:n()(S.FormattedMessage,{defaultMessage:"No items",id:"mobileCalendarDayMenu.noResults.message"})})),r&&r.length>0&&n()(D.Z,{},void 0,r.map((e=>{const t=B.G.createChildStore(i,{id:e.id,table:y.iU});return this.renderItem(t,e,o,s)}))),!e&&n()(D.Z,{topBorder:!0},void 0,n()(P.Z,{focused:!1,onClick:this.handleAddItemClick,title:n()(S.FormattedMessage,{defaultMessage:"New item",id:"mobileCalendarDayMenu.newItemButton.label"})})))},this.handleLeftClick=()=>{const e=this.getCurrentStartOfDay();this.stores.store.setState({...this.stores.store.state,currentStartOfDay:e.minus({day:1}).valueOf()})},this.handleRightClick=()=>{const e=this.getCurrentStartOfDay();this.stores.store.setState({...this.stores.store.state,currentStartOfDay:e.plus({day:1}).valueOf()})},this.handleAddItemClick=()=>{const{collectionContextStore:e,calendarBy:t,resultsStore:i}=this.props,o=this.getCurrentStartOfDay(),{performResult:n}=T.createAndCommit({userAction:"MobileCalendarDayMenu.newStore",environment:this.environment,perform:n=>{const{newStore:s}=v.IW({environment:this.environment,collectionContextStore:e,groupsPointer:[],results:i.state,insertAtIndex:0,coerce:!1,initializeDefaultTemplate:!0,transaction:n,from:"mobile_calendar_day_menu"});return f.xD({type:"timestamp",environment:this.environment,store:s,propertyId:t,timestampMs:o.valueOf(),transaction:n}),s}}),s=(0,C.ZP)({store:n,pageVisitSource:u.tY.Create});this.navigate(s)},this.reducerStore=this.createComputedStore((()=>{const{collectionContextStore:e}=this.props;return(0,M.YG)({collectionContextStore:e,startOfDay:this.getCurrentStartOfDay().valueOf()})}),!0)}navigate(e){this.context.overrideLinkClick?this.context.overrideLinkClick(e):k.navigate({environment:this.environment,url:e})}renderComponent(){const{collectionContextStore:e}=this.props,t=this.reducerStore.state;if(t)return n()(Z.Z,{id:"calendar_day_results",reducer:t,collectionContextStore:e,render:this.renderResults,resultStore:this.stores.resultStore})}renderItem(e,t,i,o){const{disabled:s,blockPropertyValueOverlayStore:r,collectionContextStore:a}=this.props,l=a.collectionStore();if(l)return n()(K,{store:e,time:t.includeTime?this.renderTime(t,i,o):void 0,disabled:s,format:this.props.format,schema:this.props.schema,blockPropertyValueOverlayStore:r,collectionStore:l},t.id)}renderTime(e,t,i){const{schema:o,calendarBy:n,intl:s}=this.props,r=o[n];if(!r||"date"!==r.type)return;const a=r.date_format||h.sF,l=r.time_format||h.c_,c=e.start,d=e.end,u=Boolean(!(t<=c&&c<=i)||d&&!(t<=d&&d<=i));if(e.end){const t=g.iC(e.start.valueOf(),e.end?e.end.valueOf():e.start.valueOf(),e.timeZone??(0,m.r)());return u?(0,b.ZV)({value:t,date_format:a,time_format:l,userTimeZone:e.timeZone,allowRelativeDates:!0,intl:s}):(0,b.ns)({start_time:t.start_time,end_time:t.end_time,time_format:l,humanReadable:!0,intl:s})}return(0,b.mr)({start_time:g.CQ(e.start.valueOf(),e.timeZone??(0,m.r)()).start_time,time_format:l,humanReadable:!0,intl:s})}getCurrentStartOfDay(){const{currentStartOfDay:e}=this.stores.store.state;return e?a.ou.fromMillis(e):a.ou.fromMillis(this.props.initialStartOfDay)}getCurrentResults(){const{collectionContextStore:e}=this.props,t=e.collectionStore();if(!t)return;const i=this.stores.resultStore.state,o=e.normalizedQueryStore.state,n=e.normalizedSchemaStore.state,s=o?o.calendar_by:void 0;if(!(i&&o&&s&&n))return;let a=r().compact(i.blockIds.map((e=>{const i=B.G.createChildStore(t,{id:e,table:y.iU});return(0,M.BO)({blockStore:i,calendarBy:s,schema:n,getRecordValue:t.getRecordValue,intl:this.props.intl})})));return o.sort||(a=r().sortBy(a,(e=>e.start))),a}}Y.displayName="MobileCalendarDayMenu",Y.contextTypes={...A.wK,...c.w},Y.headerStyle={display:"flex",alignItems:"center",height:"100%"};const Q=(0,S.injectIntl)(Y)},25079:(e,t,i)=>{i.r(t),i.d(t,{default:()=>Pe});var o=i(77094),n=i.n(o),s=i(97464),r=i.n(s),a=i(67294),l=i(83355),c=i(69615),d=i(15145),u=i(8848),h=i(3779),m=i(75934),p=i(5366),b=i(61045),g=i(87531),y=i(74647),S=i(29974),f=i(95477),v=i(28020),k=i(43250),T=i(73744),A=i(71119),M=i(59488),C=i(52533),x=i(45010),I=i(45094),w=i(21115),B=i(8323),P=i(34859),Z=i(27832),R=i(10161),N=i(12768),F=i(72087),_=i(45589),D=i(7755),U=i(78291),O=i(23063),q=i(64921),E=i(3386),V=i(77137),G=i(18647),L=i(45055),W=i(5978),j=i(60709),z=i(88632),$=i(53610),H=i(31945),K=i(78140),Y=i(64369),Q=i(27386),J=i(14694),X=i(19091);class ee extends l.Z{constructor(){super(...arguments),this.handleClose=()=>{const{mobileNative:e}=this.environment,t=()=>{$.Z.setState({open:!1})};null!=e&&e.supportsNativeHomeOnPhone()?W.navigateToHomeTab(this.environment,t):t()}}renderComponent(){const{store:e}=this.props;if(!(0,B.Mk)()||!e.isDefined())return;const{mobileNative:t}=this.environment,i=(null==t?void 0:t.supportsNativeHomeOnPhone())||!1;return n()(H.ZP,{buttonPopupStore:$.Z,popupType:H.Z4.SlideUp,hidesMobileNativeBottomBar:i,preventSlideUpTransition:i,renderOrigin:e=>a.createElement(q.Z,r()({mobileFeedback:!0},e),n()(J.Z,{left:this.renderIcon(),disableMobileBorder:!0},void 0,n()(p.FormattedMessage,{defaultMessage:"Members",id:"memberSettingsButton.mobileSidebar.label"}))),render:()=>{if(z.Z.state.online){const t={menuType:j.og.Modal,title:n()(p.FormattedMessage,{defaultMessage:"Members",id:"memberSettingsButton.mobileMemberSettings.title"}),right:n()(p.FormattedMessage,{defaultMessage:"Done",id:"memberSettingsButton.rightActionButton.done"}),onClickRight:this.handleClose,onCancel:this.handleClose};return a.createElement(K.Z,t,n()(X.Z,{store:e,isMobile:!0}))}this.renderOffline()}})}renderIcon(){return h.Z.teamSize({fill:this.theme.mediumIconColor,width:16})}renderOffline(){return n()(Q.Z,{},void 0,n()(Y.Z,{isSmall:!0,style:{textAlign:"center"}},void 0,n()(p.FormattedMessage,{defaultMessage:"Please go online to manage members.",id:"memberSettingsButton.goOnline.prompt"})))}}ee.displayName="MemberSettingsButton";const te=ee;var ie=i(14786),oe=i(83590);class ne extends l.Z{constructor(){super(...arguments),this.handleClose=()=>{const{mobileNative:e}=this.environment,t=()=>{ie.Z.setState({open:!1})};ie.Z.state.source!==ie.Y.Updates&&((null==e?void 0:e.supportsNativeHomeOnPhone())||!1)?W.navigateToHomeTab(this.environment,t):t()}}renderComponent(){const{device:e,mobileNative:t}=this.environment,i=ie.Z.state.open,o=ie.Z.state.source!==ie.Y.Updates&&((null==t?void 0:t.supportsNativeHomeOnPhone())||!1);return n()(H.ZP,{popupType:e.isMobile?H.Z4.SlideUp:H.Z4.Popup,hidesMobileNativeBottomBar:o,preventSlideUpTransition:o,buttonPopupStore:ie.Z,renderOrigin:t=>a.createElement(q.Z,r()({mobileFeedback:e.isMobile},t),n()(J.Z,{left:h.Z.sidebarSettings({fill:this.theme.mediumIconColor,width:16}),style:{background:i?this.theme.buttonHoveredBackground:"none"},disableMobileBorder:!0},void 0,n()(p.FormattedMessage,{defaultMessage:"Notifications & settings",id:"notificationSettingsButton.mobileSidebar.label"}))),render:()=>{let t;return t=e.isMobile?{menuType:j.og.Modal,title:n()(p.FormattedMessage,{defaultMessage:"Notifications & settings",id:"notificationSettingsButton.mobileSidebar.title"}),right:n()(p.FormattedMessage,{defaultMessage:"Done",id:"notificationSettingsButton.rightActionButton.done"}),onClickRight:this.handleClose,onCancel:this.handleClose,whiteBackground:!0}:{menuType:j.og.Popup},a.createElement(K.Z,t,n()(oe.Z,{isMobile:!0,passwordRequestStore:this.props.passwordRequestStore}))}})}}ne.displayName="NotificationSettingsButton";const se=ne;var re=i(22541),ae=i(12334),le=i(31054),ce=i(32016),de=i(37064),ue=i(88461),he=i(29477),me=i(24677),pe=i(80796),be=i(29337);const ge=200;class ye extends l.Z{constructor(){super(...arguments),this.handleTouchStart=e=>{const t={x:e.touches[0].clientX,y:e.touches[0].clientY};D.TC.state?t.x>(0,I.qG)(this.environment)?be.Z.setState({touching:!0,swiping:!1,start:t}):this.handleReset():(0,I.YR)(this.environment)&&t.x<100?be.Z.setState({touching:!0,swiping:!1,start:t}):this.handleReset()},this.handleTouchMove=e=>{if(pe.Z.state.isDragging)return void this.handleReset();const t=be.Z.state;if(!t.touching)return;const i={x:e.touches[0].clientX,y:e.touches[0].clientY};if(t.swiping)be.Z.setState({touching:!0,swiping:!0,start:t.start,speed:D.TC.state?t.end.x-i.x:i.x-t.end.x,end:i});else{if(Math.abs(i.y-t.start.y)>=25)return void this.handleReset();(!D.TC.state&&i.x-t.start.x>25||D.TC.state&&t.start.x-i.x>25)&&be.Z.setState({touching:!0,swiping:!0,start:t.start,speed:0,end:i})}this.updateTransform()},this.handleTouchEnd=async()=>{const{ThemeStore:e}=this.environment,t=be.Z.state;if(!t.swiping)return;const i=(0,I.qG)(this.environment),o=document.querySelector((0,I.YR)(this.environment)?`.${k.ykc}`:`.${k.Wiy}`),n=document.querySelector(`.${k.Wiy}`),s=Math.abs(t.speed)>=8,r=s?"ease-out":"ease-in-out",a="dark"===e.state.mode?`, 1px 0 0 ${this.theme.shadowColor.alpha(2*this.theme.shadowOpacity).css()}`:"",l=`\n\t\t\t${this.theme.mediumBoxShadow}\n\t\t\t${a}\n\t\t`;if(D.TC.state){const e=t.start.x-t.end.x;if(e+25*t.speed>i/2){let t=s?(i-e)/i*ge:ge;t=Math.max(t,1),o.style.transition=`transform ${t}ms ${r}`,o.style.transform="translateZ(0)translateX(0px)",(0,I.YR)(this.environment)&&(o.style.boxShadow=l,n.style.transition=`filter ${t}ms ${r}`,n.style.filter="brightness(1)"),await fe(o),y.close(),this.handleReset()}else o.style.transition=`transform 200ms ${r}`,o.style.transform=`translateZ(0)translateX(${i}px)`,(0,I.YR)(this.environment)&&(o.style.boxShadow=l,n.style.transition=`filter 200ms ${r}`,n.style.filter="brightness(0.7)"),await fe(o),this.handleReset()}else{const e=t.end.x-t.start.x;if(e+25*t.speed>i/2){let t=s?(i-e)/i*ge:ge;t=Math.max(t,1),o.style.transition=`transform ${t}ms ${r}`,o.style.transform=`translateZ(0)translateX(${i}px)`,(0,I.YR)(this.environment)&&(o.style.boxShadow=l,n.style.transition=`filter ${t}ms ${r}`,n.style.filter="brightness(0.7)"),await fe(o),y.open(),this.handleReset()}else o.style.transition=`transform 200ms ${r}`,o.style.transform="translateZ(0)translateX(0px)",(0,I.YR)(this.environment)&&(o.style.boxShadow=l,n.style.transition=`filter 200ms ${r}`,n.style.filter="brightness(1)"),await fe(o),this.handleReset()}},this.handleSidebarToggle=()=>{this.updateTransform()},this.updateTransform=()=>{const e=document.querySelector((0,I.YR)(this.environment)?`.${k.ykc}`:`.${k.Wiy}`),t=document.querySelector(`.${k.ykc}`),i=document.querySelector(`.${k.Wiy}`),o=(0,I.qG)(this.environment),n=be.Z.state;if(this.environment.device.isIOS&&(i.style.transform="translateZ(0)translateX(0px)",i.style.filter="brightness(1)",t.style.transform="translateZ(0)translateX(0px)",t.style.filter="brightness(1)"),n.swiping)if(D.TC.state){const t=o-(n.start.x-n.end.x)+25,s=Math.min(Math.max(0,t),o);if(e.style.transition="none",e.style.transform=`translateZ(0)translateX(${s}px)`,(0,I.YR)(this.environment)){e.style.boxShadow=this.theme.mediumBoxShadow,i.style.transition="none";const t=(1-.3*s/o).toString();i.style.filter=`brightness(${t})`}}else{const t=n.end.x-n.start.x-25,s=Math.min(Math.max(0,t),o);if(e.style.transition="none",e.style.transform=`translateZ(0)translateX(${s}px)`,(0,I.YR)(this.environment)){e.style.boxShadow=this.theme.mediumBoxShadow,i.style.transition="none";const t=(1-.3*s/o).toString();i.style.filter=`brightness(${t})`}}else D.TC.state?(e.style.transition="transform 200ms",e.style.transform=`translateZ(0)translateX(${o}px)`,(0,I.YR)(this.environment)&&(e.style.transform=`translateZ(0)translateX(calc(${o}px - 1px))`,e.style.boxShadow=this.theme.mediumBoxShadow,i.style.transition="filter 200ms",i.style.filter="brightness(0.7)"),me.ZH(this.environment)):(e.style.transition="transform 200ms",e.style.transform="translateZ(0)translateX(0)",(0,I.YR)(this.environment)&&(e.style.boxShadow="none",i.style.transition="filter 200ms",i.style.filter="brightness(1)"))}}didMount(){const{device:e}=this.environment;e.isMobile&&(window.addEventListener("touchstart",this.handleTouchStart),window.addEventListener("touchmove",this.handleTouchMove),window.addEventListener("touchend",this.handleTouchEnd),D.TC.addListener(this.handleSidebarToggle))}willUnmount(){const{device:e}=this.environment;e.isMobile&&(window.removeEventListener("touchstart",this.handleTouchStart),window.removeEventListener("touchmove",this.handleTouchMove),window.removeEventListener("touchend",this.handleTouchEnd),D.TC.removeListener(this.handleSidebarToggle))}handleReset(){be.Z.reset(),this.updateTransform()}}ye.displayName="SidebarMobileSwipeListener";const Se=ye;async function fe(e){const t=he.UZ();e.addEventListener("transitionend",t.resolve),e.addEventListener("webkitTransitionEnd",t.resolve),await t.promise,e.removeEventListener("transitionend",t.resolve),e.removeEventListener("webkitTransitionEnd",t.resolve)}var ve=i(98285),ke=i(31280),Te=i(21323),Ae=(i(73499),i(79311)),Me=i(50906),Ce=i(85266);class xe extends l.Z{renderComponent(){const e=n()(p.FormattedMessage,{defaultMessage:"Upgrade to Pro",id:"upgradeMobileButton.upgradeButton.label"});return n()(q.Z,{mobileFeedback:!0,onClick:this.showUpgradeModal(this.environment)},void 0,n()(J.Z,{left:this.renderIcon(),disableMobileBorder:!0},void 0,e))}renderIcon(){return h.Z.settingsUpgradeFilled({fill:this.theme.mediumIconColor,width:16})}showUpgradeModal(e){return()=>{Me.sA6(e,{from:"mobile_sidebar",for_subscription_tier:"personal"});const{mobileNative:t}=e;t&&t.openUpgradeModal(Ce.Bs())}}}xe.displayName="UpgradeMobileButton";const Ie=xe;var we=i(22715);class Be extends l.Z{constructor(){super(...arguments),this.storeTypes={scrollerStore:_.Z,passwordRequestStore:F.Z},this.handleScrollerMount=e=>{x.Z.SidebarMobileScroller=e},this.handleCloseSidebar=()=>{y.close()},this.handleClickFind=()=>g.Kf({environment:this.environment,analyticsFrom:"sidebar-mobile"}),this.handleOrientationChange=()=>{y.close()},this.isScrolledToTop=this.createComputedStore((()=>0===this.stores.scrollerStore.state.scrollTop)),this.isCurrentIAPSubscriber=()=>{const{currentUserRootStore:e}=Z.default.state,t=(0,w.xR)({environment:this.environment,userRootStore:e});return!(!t||!t.includes(f.Z.revenueCat.productIDs.personal.monthly)&&!t.includes(f.Z.revenueCat.productIDs.personal.yearly))}}willMount(){window.addEventListener("resize",this.handleOrientationChange)}willUnmount(){window.removeEventListener("resize",this.handleOrientationChange)}renderComponent(){const e=N.default.state;if(e.isOnboarding&&"workspace_setup"===e.stage)return;if((0,M.Y)("supportsNativeHome")&&"on"!==R.default.getGroup("mobile-home-tab-allow-web-sidebar")){const{currentSpaceStore:e,mainEditorCurrentBlockStore:t}=Z.default.state;return n()("div",{className:k.alX},void 0,a.createElement(ve.Z,r()({createType:"add-account"},this.stores)),e&&n()(te,{store:e}),n()(V.Z,{request:{},render:()=>{},requestStore:this.stores.passwordRequestStore,performRequest:()=>(0,A.pu)(this.environment)}),n()(se,{passwordRequestStore:this.stores.passwordRequestStore}),e&&t&&e.canEdit()&&n()(Te.Z,{store:t,isMobile:!0}),n()(L.Z,{isMobile:!0}))}const t=I.Jr(this.environment);return t?n()(O.Z,{render:()=>n()("div",{className:k.ykc,style:this.getWrapStyle()},void 0,!t&&n()(Se,{}),this.renderSidebar()),isVisible:!0,animationStyle:{width:t?I.Wk(this.environment):"100vw"}}):n()("div",{className:k.ykc,style:{...this.getWrapStyle(),width:"100vw"}},void 0,!t&&n()(Se,{}),this.renderSidebar())}renderSidebar(){return n()(E.Z,{capture:!I.Jr(this.environment)&&D.TC.state,onBackButton:this.handleCloseSidebar},void 0,n()("div",{style:this.getStyle()},void 0,this.renderTopbar(),this.renderOutliner()),(0,M.Y)("supportsNativeHome")&&n()("div",{className:k.alX},void 0,a.createElement(ve.Z,r()({createType:"add-account"},this.stores))))}renderTopbar(){const{device:e}=this.environment,t=e.isMobileNative&&e.isTablet&&I.Jr(this.environment);return n()("div",{style:this.getTopbarStyle()},void 0,n()(ke.ZP,{shouldShowUnexpandButton:t,format:ke._S.Mobile,onSpaceClick:async e=>{let{event:t,spaceViewStore:i}=e;await S.y3({environment:this.environment,spaceViewStore:i,userSettingsStore:Z.default.state.currentUserSettingsStore,userRootStore:Z.default.state.currentUserRootStore,openInNew:T.DJ(t),pageVisitSource:d.tY.SwitchSpace})}}),!e.isMobileNative&&n()(Ae.Z,{format:Ae.Z.Format.TopbarMobile}),!e.isMobileNative&&n()(q.Z,{onClick:this.handleClickFind,mobileFeedback:!0,style:Be.actionButtonStyle},void 0,h.Z.mobileBottomBarSearch({width:26})))}renderOutliner(){const{currentSpaceStore:e,currentSpaceViewStore:t,currentUserRootStore:i,currentUserStore:o,currentUserSettingsStore:s,mainEditorCurrentBlockStore:r}=Z.default.state,l=(0,v.k_)(this.environment).state;if(!(l&&t&&i&&e&&o&&s))return;const c=e.canEdit(),d=(0,C.S$)({environment:this.environment})&&B.QM()&&U.default.state.data&&"unsubscribed_admin"===U.default.state.data.type&&U.default.state.data.revenueCatEnabled&&!this.isCurrentIAPSubscriber(),u=t.getTeamsStores();return n()(de.Z,{store:e,disableEditNearestBlock:!0,render:i=>{let{selectableEvents:o}=i;return a.createElement(G.Z,{store:this.stores.scrollerStore,ref:this.handleScrollerMount,style:Be.outlinerStyle,preventType:b.Q7(this.environment),type:P.Z.Y},n()(we.Z,{}),l.showBookmarksSection&&n()(ae.Z,{type:"bookmarks",shouldPersistToggleState:!0,spaceStore:e,spaceViewStore:t,showAddButton:!1,renderSidebar:()=>n()(re.Z,{type:"bookmarks",itemDepth:0,parentStore:t.getBookmarkedPagesStore(),childStores:t.getBookmarkedPages(),onNavigate:this.handleCloseSidebar,disabled:!c})}),l.showTeamSection&&n()(ae.Z,{type:m.kg,sectionLabel:n()(p.FormattedMessage,{defaultMessage:"Teamspaces",description:"Header for the teamspaces section in the sidebar (only used on mobile web). This is the section that contains all of the teamspaces a user has joined.",id:"sidebarMobile.teamsSection.header"}),shouldPersistToggleState:!0,spaceStore:e,spaceViewStore:t,showAddButton:!1,renderSidebar:()=>n()(ue.u,{teams:u,reorderable:!1,onNavigate:this.handleCloseSidebar})}),l.showWorkspaceSection&&!l.showTeamSection&&n()(ae.Z,{type:"workspace",shouldPersistToggleState:!0,spaceStore:e,spaceViewStore:t,showAddButton:!1,renderSidebar:()=>n()(re.Z,{type:"workspace",itemDepth:0,parentStore:e.getPagesStore(),childStores:t.getWorkspacePages(),onNavigate:this.handleCloseSidebar,disabled:!c})}),l.showSharedSection&&n()(ae.Z,{type:"shared",shouldPersistToggleState:!0,spaceStore:e,spaceViewStore:t,showAddButton:!1,renderSidebar:i=>a.createElement(a.Fragment,null,n()(re.Z,{type:"shared",itemDepth:0,parentStore:t.getSharedPagesStore(),childStores:l.visibleSharedPagesStores,onNavigate:this.handleCloseSidebar,disabled:!c}),l.showSharedOverflowButton&&n()(ce.QO,{originRef:i,type:"shared",spaceStore:e,spaceViewStore:t,userSettingsStore:s,allPages:l.allSharedPagesStores,visiblePageIds:l.visibleSharedPagesStores.map((e=>{let{id:t}=e;return t})),render:e=>{let{onClick:t,isPopoverOpen:i}=e;return n()(le.A,{isPopoverOpen:i,onClick:t,moreCount:l.allSharedPagesStores.length-l.visibleSharedPagesStores.length,inline:!1})}}))}),l.showPrivateSection&&!l.showOnlyPrivateSection&&n()(ae.Z,{type:"private",shouldPersistToggleState:!0,spaceStore:e,spaceViewStore:t,showAddButton:!1,renderSidebar:()=>n()(re.Z,{type:"private",itemDepth:0,parentStore:e.getPagesStore(),childStores:t.getPrivatePages(this.environment),onNavigate:this.handleCloseSidebar,disabled:!c})}),l.showOnlyPrivateSection&&n()(re.Z,{type:"private",itemDepth:0,parentStore:e.getPagesStore(),childStores:t.getPrivatePages(this.environment),onNavigate:this.handleCloseSidebar,disabled:!c}),l.showOnlyPrivateSection&&n()("div",{style:{height:20}}),n()(te,{store:e}),n()(V.Z,{request:{},render:()=>{},requestStore:this.stores.passwordRequestStore,performRequest:()=>(0,A.pu)(this.environment)}),n()(se,{passwordRequestStore:this.stores.passwordRequestStore}),r&&e.canEdit()&&n()(Te.Z,{store:r,isMobile:!0}),d&&n()(Ie,{}),n()(L.Z,{isMobile:!0}),!1,n()("div",{style:{height:148}}))}})}getWrapStyle(){return I.Jr(this.environment)?{display:"block",height:"100vh",position:"relative",zIndex:3}:I.YR(this.environment)?{display:"block",height:"100vh",position:"fixed",top:0,right:"100%",zIndex:3}:{display:"block",height:"100vh",position:"fixed",top:0,left:0}}getStyle(){return{display:"flex",flexDirection:"column",width:I.qG(this.environment),height:"100%",background:I.YR(this.environment)?this.theme.mobileSidebarAndroidBackground:this.theme.mobileSidebarIOSBackground,willChange:"transform",color:this.theme.mediumTextColor,...I.YR(this.environment)&&{marginLeft:"auto"},...I.Jr(this.environment)&&{position:"absolute",right:0},cursor:"pointer"}}getTopbarStyle(){const{WindowSizeStore:e}=this.environment;return{display:"flex",alignItems:"center",justifyContent:"space-between",flex:"none",height:c.g,marginTop:e.state.paddingTopCSS,paddingLeft:12,boxShadow:I.YR(this.environment)&&!I.Jr(this.environment)&&D.TC.state?this.isScrolledToTop.state?this.theme.topbarAndroidShadowCollapsed:this.theme.topbarAndroidShadow:`0 1px 0 ${this.theme.regularDividerColor}`,background:I.YR(this.environment)?this.theme.androidSidebarBackground:u.ZP.transparent,transition:"box-shadow 300ms",width:"100%",zIndex:1}}}Be.displayName="SidebarMobile",Be.outlinerStyle={flexGrow:1,paddingTop:12,userSelect:"none",WebkitUserSelect:"none"},Be.actionButtonStyle={display:"flex",alignItems:"center",justifyContent:"center",flex:"none",height:"100%",width:44,paddingRight:6};const Pe=Be},49374:(e,t,i)=>{i.r(t),i.d(t,{default:()=>Ue});var o=i(97464),n=i.n(o),s=i(77094),r=i.n(s),a=i(67294),l=i(83355),c=i(1302),d=i(27328),u=i(69615),h=i(15145),m=i(8848),p=i(3779),b=i(89101),g=i(21202),y=i(82990),S=i(51454),f=i(5366),v=i(50906),k=i(17503),T=i(11302),A=i(5978),M=i(87531),C=i(24677),x=i(74647),I=i(29974),w=i(21325),B=i(98104),P=i(30149),Z=i(39865),R=i(28020),N=i(43250),F=i(78089),_=i(60709),D=i(59488),U=i(67669),O=i(58241),q=i(72444),E=i(33665),V=i(45094),G=i(38755),L=i(77907),W=i(25464),j=i(27832),z=i(61766),$=i(92547),H=i(69454),K=i(42330),Y=i(30496),Q=i(85057),J=i(97238),X=i(7755),ee=i(24666),te=i(52258),ie=i(83575),oe=i(48601),ne=i(1449),se=i(91754),re=i(64921),ae=i(31945),le=i(61519),ce=i(73063),de=i(21199),ue=i(78140),he=i(40721),me=i(89728),pe=i(44532),be=i(31278),ge=i(76798),ye=i(45653),Se=i(39849),fe=i(81954),ve=i(24809),ke=i(51655),Te=i(61208);function Ae(){window.__c={n:"MobileUpdatesModalPageTab"};const e=(0,a.useCallback)((()=>r()(Te.Z,{message:r()(f.FormattedMessage,{defaultMessage:"Any changes to this page will show up here.",id:"updatesModal.currentPageTab.emptyPrompt"}),title:r()(f.FormattedMessage,{defaultMessage:"No page updates",id:"updatesModal.currentPageTab.emptyPromptTitle"})})),[]),t=(0,fe.VK)((()=>j.default.state.currentSpaceStore),[]),i=(0,fe.VK)((()=>j.default.state.mainEditorCurrentBlockStore),[]),o=(0,fe.VK)((()=>{var e;const t=null==i||null===(e=i.getCollectionPointer())||void 0===e?void 0:e.id,o=null==i?void 0:i.isCollectionView();return null!=i&&i.isDefined()?{id:i.id,isCollection:o,collectionId:t}:void 0}),[i]);return t&&o&&i?r()("div",{},void 0,r()(ke.Z,{navigableBlock:i,from:"page_updates"}),r()(ve.Z,{navigableBlock:i,collectionId:o.collectionId,spaceId:t.id,empty:e,source:"updates_sidebar"},"current-page")):null}var Me=i(92955),Ce=i(22789),xe=i(50708),Ie=i(13612),we=i(69525),Be=i(94686),Pe=i(55725),Ze=i(55960),Re=i(11819),Ne=i(12253),Fe=i(23727),_e=i(13018);class De extends l.Z{constructor(){super(...arguments),this.storeTypes={shareButtonPopupStore:z.Z},this.hasUnreadCommentsStore=this.createComputedStore((()=>(0,F.DF)({blockStore:this.props.store,currentUserId:this.environment.currentUser.id}).some((e=>!e.getResolved()&&(0,F.NI)(e).some((t=>k.t({discussionStore:e,commentStore:t})))))),!1),this.handleOpenQuickFind=()=>{M.UT({environment:this.environment,analyticsFrom:"public-page-topbar"})},this.handleShareClick=()=>{v.DB2(this.environment),w.bi(this.environment)},this.handleTopbarClick=()=>{C.ZH(this.environment)},this.handleUpdatesClick=()=>{Y.Z.setState({open:!0}),v.gMH(this.environment)},this.navigateToFirstSpace=()=>{const{currentUserRootStore:e,currentUserSettingsStore:t}=j.default.state;e&&t&&I.L5({environment:this.environment,userRootStore:e,userSettingsStore:t,pageVisitSource:h.tY.SwitchSpace})},this.handleAddToClick=async()=>{await T.$X({environment:this.environment,blocks:[this.props.store],moveToContext:"quick_add",onAccept:this.handleAddToAccept,isAddTo:!0,isDefaultPrivateLocation:this.isDefaultPrivateLocation()})},this.handleAddToAccept=e=>{const{currentSpaceStore:t}=j.default.state;t&&this.props.saveParent&&x.setQuickAddParent({currentUserId:this.environment.currentUser.id,spaceId:t.id,value:e}),v.xx2(this.environment)},this.handleCancelQuickAdd=e=>{const t=j.default.state.mainEditorCurrentBlockStore,i=K.ZP.state.lastPageId;if(t){var o;const e=null===(o=this.environment.mobileNative)||void 0===o?void 0:o.supportsNativeHomeOnPhone();e?A.navigateToHomeTab(this.environment):i?A.navigateToBlock({environment:this.environment,store:Q.G.createChildStore(t,{table:g.iU,id:i}),showMoveTo:!1,saveParent:!1,redirect:e,pageVisitSource:h.tY.BackForward}):A.navigate({environment:this.environment,url:b._j.root,redirect:!0}),P.createAndCommit({userAction:"TopbarMobile.handleCancelQuickAdd",environment:this.environment,perform:e=>{Z.y8({environment:this.environment,blocks:[t],transaction:e}),e.postSubmitCallbacks.push((e=>{e||v.dhV(this.environment,{analyticsName:"delete",from:"mobile_topbar",block_id:t.id,block_type:"page"})}))}})}}}renderComponent(){const{store:e}=this.props,{WindowSizeStore:t,device:i}=this.environment,o=(0,U.IJ)(this.environment,this.props.store),s=new $.Z,l=(e.isLocked()||s.state.justUnlocked)&&e.canEdit(),c=(!o||e.canEditCollection())&&i.isPhone&&(e.isRestricted()||l);return r()(de.Z,{capture:!0,render:i=>a.createElement("div",n()({},i,{style:this.getWrapStyle()}),o?this.renderPublicPageTopbar():this.renderNormalTopbar(),c&&r()(se.Z,{type:se.$.White,isMobile:!0,style:{justifyContent:"unset"}},void 0,r()(Ce.Z,{store:this.props.store,isMobile:!0,lockStore:s},this.props.store.id),e.isRestricted()&&a.createElement(a.Fragment,null,l&&r()(le.Z,{vertical:!0,size:10,style:{height:"50%"}}),r()(Ne.Z,{style:{marginRight:8},onClick:()=>{this.stores.shareButtonPopupStore.setState({open:!0})}}))),this.props.isOffline&&r()(se.Z,{type:se.$.White,isMobile:!0},void 0,r()("div",{style:{display:"flex",alignItems:"center",width:"100%",paddingLeft:t.getSafePaddingLeftCSS(10),paddingRight:t.getSafePaddingRightCSS(14)}},void 0,p.Z.mobileOffline({width:26,marginRight:12}),r()("div",{},void 0,r()(f.FormattedMessage,{defaultMessage:"You're offline",id:"topbarMobile.offline.message"})))),r()(oe.Z,{banners:this.props.banners,isMobile:!0,isInPeekRenderer:!1}))})}renderPublicPageTopbar(){const{store:e}=this.props;return r()("div",{onClick:this.handleTopbarClick,style:this.getStyle(),className:N.ZHw},void 0,this.environment.currentUser.isLoggedIn()&&r()(a.Fragment,{},void 0,r()(re.Z,{style:{display:"flex",alignItems:"center",height:"100%",paddingLeft:14,paddingRight:14,fontWeight:y.Z.fontWeight.medium,color:this.theme.regularTextColor,whiteSpace:"nowrap"},mobileFeedback:!0,onClick:this.navigateToFirstSpace},void 0,r()(f.FormattedMessage,{defaultMessage:"Back",id:"topbarMobile.backButton.label"})),r()("div",{style:{height:18,width:1,flexShrink:0,marginRight:6,background:this.theme.darkDividerColor}})),r()(ne.Z,{store:this.props.store,style:this.getBreadcrumbsStyle(),maxAncestorCount:1,showCurrentPageControls:!1,ancestorMaxWidth:100,currentPageMaxWidth:220,isMobile:!0}),r()("div",{style:{flexGrow:1,flexShrink:1}}),r()(me.Z,{onClick:this.handleOpenQuickFind},void 0,p.Z.searchThick({width:20,height:20})),r()(Ie.Z,{store:e,buttonPopupStore:te.Z}))}renderNormalTopbar(){const{store:e,pageVisitStore:t,presenceStore:i,hideActionButtons:o}=this.props,{device:n}=this.environment,{isTablet:s}=n,l=this.props.isInvalidPage,c=this.shouldRenderBackButton();return r()("div",{onClick:this.handleTopbarClick,style:this.getStyle(),className:N.ZHw},void 0,this.shouldShowHamburgerButton()&&this.renderHamburgerButton(),c&&r()(Be.Z,{supportsNativeHomeTabPhone:!s&&(0,D.Y)("supportsNativeHome")}),!l&&this.renderBreadcrumbs(c),e.canEditCollection()&&s&&r()(Ce.Z,{store:e,isMobile:!1},e.id),r()(Pe.Z,{}),!o&&a.createElement(a.Fragment,null,e.isRestricted()&&s&&r()(Ne.Z,{style:{marginRight:8},onClick:()=>{this.stores.shareButtonPopupStore.setState({open:!0})}}),s&&e.canEdit()&&t&&i&&r()(Re.Z,{rootStore:e,pageVisitStore:t,presenceStore:i}),this.shouldShowCancelQuickAdd()?this.renderCancelQuickAdd():this.renderRightButtons()))}isEmptyPageAndTitle(){const{store:e}=this.props;return e.isEmptyTitle()&&e.isEmptyPage()}shouldShowCancelQuickAdd(){return this.props.shouldShowAddTo&&this.isEmptyPageAndTitle()}isTabletWithNativeHome(){return(0,D.Y)("supportsNativeHome")&&this.environment.device.isTablet}shouldShowHamburgerButton(){return this.isTabletWithNativeHome()||!(0,D.Y)("supportsNativeHome")}renderHamburgerButton(){return r()(re.Z,{mobileFeedback:!0,style:{position:"relative",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0,height:"100%",width:36,marginLeft:4},onClick:()=>{var e;if(this.isTabletWithNativeHome())null===(e=this.environment.mobileNative)||void 0===e||e.toggleNativeHome();else if((0,V.Jr)(this.environment))x.setExpand({environment:this.environment,isExpanded:!X.gV.state,from:"topbar_mobile"});else{const{NativeMobileActionBarStore:e}=this.environment,t=e?e.state.menuType:null;"editing"===ee.default.state.mode||null!==t?(B.ZH(this.environment),null==e||e.clear(!1),H.Z.onHide((()=>{c.default.afterNextFlush((()=>x.open()))}))):x.open()}v.jDo(this.environment)}},void 0,p.Z.hamburgerMenu({width:18,height:18}),r()(Me.Z,{type:this.environment.device.isMobileBrowser?"allSpaces":"otherSpaces",color:Se.Z.Color.Red,style:{position:"absolute",top:9,right:1}}))}renderBreadcrumbs(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const{isTablet:t}=this.environment.device,i=(0,O.q)();return this.props.shouldShowAddTo?this.renderAddTo():i?r()(xe.Z,{}):r()(ne.Z,{store:this.props.store,style:this.getBreadcrumbsStyle(e),maxAncestorCount:t?2:1,showCurrentPageControls:!1,ancestorMaxWidth:t?160:100,currentPageMaxWidth:t?240:220,isMobile:!0})}shouldRenderBackButton(){const{TabbedRouterStore:e}=this.environment,t=(0,E.NW)(this.environment)||"native"===(0,d.w_)(e.state).type;return!(0,E.__)(this.environment)||t}renderAddTo(){const{store:e}=this.props,t=e.getParentStore(),i=this.isDefaultPrivateLocation();if(!(t instanceof Q.T5||t instanceof Q.zq)&&t){if(i){const e=this.theme.mediumTextColor;return r()(re.Z,{mobileFeedback:!0,style:this.getAddToButtonStyle(),onClick:this.handleAddToClick},void 0,r()(f.FormattedMessage,{defaultMessage:"<mediumcolor>Add to</mediumcolor>{userAvatar}<mediumweight>Private pages</mediumweight>",id:"topbarMobile.addToPrivateSectionButton.label",values:{mediumcolor:t=>r()("span",{style:{color:e,marginRight:8}},void 0,t),mediumweight:e=>r()("span",{style:{fontWeight:y.Z.fontWeight.medium,marginLeft:4}},void 0,e),userAvatar:r()(ye.Z,{size:22,avatarShouldShowShadow:!0,userStore:(0,R.B7)(this.environment)})}}),this.renderChevron())}{const i=e instanceof Q.H2?(0,G.Wd)(this.environment,e):e.getIcon();return r()(re.Z,{mobileFeedback:!0,style:this.getAddToButtonStyle(),onClick:this.handleAddToClick},void 0,r()("span",{style:{color:this.theme.mediumTextColor}},void 0,r()(f.FormattedMessage,{defaultMessage:"Add to",id:"topbarMobile.addToPageOrWorkspaceSectionButton.label",description:"Displayed to the user in front of a page or space, like 'Add to Page', where 'Page' is an existing page."})," "),r()(be.Z,{disabled:!0,icon:i,isEmptyPage:t.table===g.iU&&t.isEmptyPage(),title:t instanceof Q.H2?(0,G.rn)(this.environment,t):void 0,size:24,style:{marginLeft:8,marginRight:4}}),r()(ge.ZP,{style:{fontWeight:y.Z.fontWeight.semibold},store:t}),this.renderChevron())}}}renderChevron(){return p.Z.chevronDown({marginLeft:4,width:10,fill:this.theme.lightTextColor})}renderRightButtons(){const{store:e,spaceStore:t,isInvalidPage:i}=this.props;if(i||(0,q.Gm)(e))return;const o=Boolean(t&&!t.canEdit()),n=e.canEdit(),s=(0,we.UP)({isSpaceGuest:o,canEditPage:n})&&!(0,q.Gm)(e),l=!(0,q.Gm)(e),c=(0,we.W2)({canEditPage:n,device:this.environment.device});return r()(a.Fragment,{},void 0,this.renderPageUpdatesPopupOrigin(),s&&this.renderShare(),l&&this.renderCommentsButton(),c&&r()(Fe.l,{onClick:this.handleUpdatesClick}),this.renderShowMore())}renderCancelQuickAdd(){return r()(re.Z,{mobileFeedback:!0,style:{display:"flex",alignItems:"center",height:"100%",paddingLeft:16,paddingRight:16,fontWeight:y.Z.fontWeight.medium,color:m.ZP.blue},onClick:this.handleCancelQuickAdd},void 0,r()(f.FormattedMessage,{defaultMessage:"Cancel",id:"topbarMobile.cancelQuickAddButton.label"}))}renderShowMore(){return r()(Ze.Z,{store:this.props.store,collectionViewStore:this.props.collectionViewStore,buttonPopupStore:te.Z})}renderShare(){const{device:e}=this.environment;return r()(ae.ZP,{popupType:e.isMobile?ae.Z4.SlideUp:ae.Z4.Popup,style:{width:460},buttonPopupStore:this.stores.shareButtonPopupStore,onClick:this.handleShareClick,renderOrigin:t=>a.createElement(re.Z,n()({mobileFeedback:!0,style:De.actionButtonStyle},t),e.isAndroid?p.Z.androidShare({width:16,height:16}):p.Z.iOSShare({width:26})),render:()=>r()(L.LazyShareMenuContainer,{buttonPopupStore:this.stores.shareButtonPopupStore,store:this.props.store,onClose:()=>{this.stores.shareButtonPopupStore.setState({...this.stores.shareButtonPopupStore.state,open:!1}),J.ZP.reset()},location:"topbar_mobile"})})}renderPageUpdatesPopupOrigin(){const e={menuType:_.og.Modal,title:r()(f.FormattedMessage,{defaultMessage:"Page Updates",id:"pageUpdatesModal.mobileMenu.title"}),right:r()(he.DoneMenuText,{}),onClickRight:()=>Y.Z.setState({open:!1}),whiteBackground:!0};return r()(pe.ZP,{open:Y.Z.state.open,popupType:ae.Z4.SlideUp,alignmentToOrigin:W.v.Start,placementToOrigin:W.u.Right,onDismiss:()=>Y.Z.setState({open:!1}),originGap:0,isWideTabletWidth:!0,render:()=>a.createElement(ue.Z,e,r()(Ae,{})),isFullWidthOnMobile:!0,preventScaleTransition:!0})}renderCommentsButton(){return r()(ae.ZP,{buttonPopupStore:ie.Z,popupType:ae.Z4.SlideUp,alignmentToOrigin:W.v.Start,placementToOrigin:W.u.Right,originGap:0,stopClickPropagation:!0,isWideTabletWidth:!0,render:e=>r()(ue.Z,{menuType:_.og.Modal,scrollerStyle:{paddingBottom:0},title:r()(f.FormattedMessage,{defaultMessage:"Comments",id:"topbarMobile.commentsMenu.title"}),right:r()(he.DoneMenuText,{}),onClickRight:e.close},void 0,r()(_e.J,{timeMounted:Date.now(),location:"popup"})),isFullWidthOnMobile:!0,preventScaleTransition:!0,renderOrigin:e=>r()("div",{style:{position:"relative",height:"100%"}},void 0,a.createElement(ce.Z,n()({icon:p.Z.mobileTopbarComments,iconStyle:{width:26,height:26,fill:"inherit"},isDarkIconColor:!0,style:{marginLeft:6,marginRight:6,height:"100%"},mobileFeedback:!0},e)),this.hasUnreadCommentsStore.state&&r()("div",{style:{position:"absolute",top:9,right:5,height:8,width:8,borderRadius:4,background:m.ZP.red}}))})}isDefaultPrivateLocation(){const e=this.props.store.getParentStore(),{currentSpaceStore:t}=j.default.state;return e instanceof Q.H2&&t&&e.id===t.id}getWrapStyle(){return{width:"100%",maxWidth:"100vw",zIndex:S.lI}}getStyle(){const{WindowSizeStore:e}=this.environment;return{display:"flex",justifyContent:"space-between",alignItems:"center",width:"100%",maxWidth:"100vw",height:u.g,marginTop:e.state.paddingTopCSS,paddingLeft:e.getSafePaddingLeftCSS(0),paddingRight:this.props.shouldShowAddTo?e.getSafePaddingRightCSS(0):e.getSafePaddingRightCSS(7),boxShadow:`0 1px 0 ${this.theme.regularDividerColor}`,background:this.theme.contentBackground,transition:"box-shadow 300ms",WebkitUserSelect:"none",cursor:"pointer"}}getBreadcrumbsStyle(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const{mobileNative:t,device:i}=this.environment,{isTablet:o}=i;return{flexGrow:0,marginLeft:null!=t&&t.supportsNativeHomeOnPhone()?e?0:20:2,overflow:"auto",WebkitOverflowScrolling:"touch",marginRight:o?16:8,height:"100%"}}getAddToButtonStyle(){let e=0;return e=this.isTabletWithNativeHome()?8:this.shouldRenderBackButton()?6:16,{display:"flex",alignItems:"center",paddingLeft:e,paddingRight:12,fontSize:y.Z.fontSize.UIRegular.mobile,lineHeight:y.Z.lineHeight.UIRegular.mobile,whiteSpace:"nowrap",minWidth:0}}}De.displayName="TopbarMobile",De.actionButtonStyle={display:"flex",alignItems:"center",height:"100%",paddingLeft:8,paddingRight:8},De.notionLogoStyle={width:18,height:18,marginRight:6,fill:"inherit"};const Ue=De},46111:(e,t,i)=>{i.r(t),i.d(t,{default:()=>ae});var o=i(77094),n=i.n(o),s=i(96486),r=i.n(s),a=i(67294),l=i(83355);function c(e,t){const i=(0,a.useRef)(Math.random().toString(36).substr(2,9)),o=t,n=(0,a.useRef)();return(0,a.useEffect)((()=>{if(n&&n.current&&r().isEqual(n.current,o))return;const t=i.current;e&&(e({type:"mount",id:t,props:o}),n.current=o)}),[e,o]),e?i.current:void 0}var d=i(480),u=i(41432),h=i(8848),m=i(97880),p=i(36054),b=i(74487);function g(e,t,i){const{content:o,apiRequestValue:n}=i;return{id:e,content:o,action:{type:t,apiRequestValue:n}}}const y=["insertBlock","turnInto","textColor","textSelectionColor"],S=["textFormatting"];function f(e,t){return{type:e,apiRequestValue:t}}function v(e,t,i){const o={type:e,from:i,data:t};return JSON.stringify(o)}const k={showActionBarMenu:b.object({required:{type:b.literal("showActionBarMenu"),data:b.object({required:{actionBarMenuId:b.literals("textColor","insertBlock","turnInto","template")},optional:{}})},optional:{}}),blockAction:b.object({required:{type:b.literals("blockAction"),data:b.object({required:{action:b.literals("bold","italic","underline","strikethrough","link","code","equation","mention","trash","comment","filePicker","indent","unindent","moveUp","moveDown","undo","redo","dismissKeyboard","more","ai")},optional:{}})},optional:{from:b.literals("mobile_action_bar","mobile_text_formatting_menu")}})},T=Object.keys(k);let A;!function(e){e[e.InvalidActionType=0]="InvalidActionType",e[e.MissingPayload=1]="MissingPayload",e[e.InvalidRequestType=2]="InvalidRequestType",e[e.InvalidData=3]="InvalidData"}(A||(A={}));class M{constructor(e,t){this.type=e,this.message=t}}function C(e){return 0===e.reduce(((e,t)=>e+t.items.length),0)}function x(e){return[g("mab.button.moveUp","webAction_generic",{content:{type:"icon",imageReference:{sfProGlyphName:"arrow.up.to.line.alt",localImageIdentifier:"moveUp"},accessibilityText:e.accessibilityTexts.moveUp,disabled:e.disableBlockActions},apiRequestValue:{jsonPayload:v("blockAction",{action:"moveUp"})}}),g("mab.button.moveDown","webAction_generic",{content:{type:"icon",imageReference:{sfProGlyphName:"arrow.down.to.line.alt",localImageIdentifier:"moveDown"},accessibilityText:e.accessibilityTexts.moveDown,disabled:e.disableBlockActions},apiRequestValue:{jsonPayload:v("blockAction",{action:"moveDown"})}})]}function I(e){const{id:t,disableBlockActions:i,disableIndent:o,disableUnindent:n,shouldFadeIn:s,includeUpAndDown:r,accessibilityTexts:a}=e;if(!(i||o&&n)){var l={id:t,shouldFadeIn:s,buttons:[g("mab.button.indent","webAction_generic",{content:{type:"icon",imageReference:{sfProGlyphName:"decrease.indent",localImageIdentifier:"unindent"},accessibilityText:a.dedent,disabled:i||n},apiRequestValue:{jsonPayload:v("blockAction",{action:"unindent"})}}),g("mab.button.unindent","webAction_generic",{content:{type:"icon",imageReference:{sfProGlyphName:"increase.indent",localImageIdentifier:"indent"},accessibilityText:a.indent,disabled:i||o},apiRequestValue:{jsonPayload:v("blockAction",{action:"indent"})}})]};if(r){var c=x({disableBlockActions:i,accessibilityTexts:{moveUp:a.moveUp,moveDown:a.moveDown}});l.buttons=l.buttons.concat(c)}return l}}var w=i(70203),B=i(5366),P=i(50906),Z=i(44886),R=i(55332),N=i(24677),F=i(8713),_=i(98104),D=i(28020),U=i(99417),O=i(33929),q=i(67074),E=i(68056),V=i(45162),G=i(89086),L=i(35328);var W=i(27832),j=i(10161),z=i(27724),$=i(60749),H=i(24666),K=i(25666),Y=i(95182),Q=i(95477),J=i(68204),X=i(47853);function ee(e){const{type:t,actionSections:i,closeParentMenu:o,context:n}=e,s={},r=[];for(const a of i){const e={id:`${a.key}`,title:a.title,items:a.actions.map((e=>{const i=`${e.key}-${e.displayName||""}`,r=e.nativeRender&&e.nativeRender(n),a=null!=r&&r.thumbnail?(0,X.D)(null==r?void 0:r.thumbnail):K.T;s[i]={...e,thumbnail:a,closeParentMenu:o};const l=/^https?:\/\//.test(a);return{id:i,title:e.displayName||"",icon:{...r,remoteImageUrl:a?`${l?"":Q.Z.domainBaseUrl}${a}`:void 0,localAssetBundleImagePath:l?void 0:a},action:f("webAction_genericAction",{menuType:t,actionId:i}),checked:!1}}))};r.push(e)}return{actions:s,sections:r}}function te(e){const{key:t,displayName:i,thumbnail:o,analyticsName:n,closeParentMenu:s,action:r}=e,a=i;return{key:`action ${t}`,displayName:i?O.default.formatMessage(i):void 0,thumbnail:o,analyticsName:n||`textformatting_action_${t}`,searchName:a?`${O.default.formatMessage(a)} ${a.defaultMessage}`:void 0,validators:[],action:r,closeParentMenu:Boolean(s)}}const ie={bold:te({key:"bold",closeParentMenu:!1,action:e=>{let{environment:t}=e;q.pk(t,["b"])}}),italic:te({key:"italic",closeParentMenu:!1,action:e=>{let{environment:t}=e;q.pk(t,["i"])}}),underline:te({key:"underline",closeParentMenu:!1,action:e=>{let{environment:t}=e;q.pk(t,["_"])}}),strikethrough:te({key:"strikethrough",closeParentMenu:!1,action:e=>{let{environment:t}=e;q.pk(t,["s"])}}),code:te({key:"code",closeParentMenu:!1,action:e=>{let{environment:t}=e;q.pk(t,["c"])}}),comment:te({key:"comment",closeParentMenu:!0,action:async e=>{var t;let{environment:i}=e;await(null===(t=i.NativeMobileActionBarStore)||void 0===t?void 0:t.clearNativeActionMenuAndRestoreSelectionIfNecessary()),q.ol(i,!0,"mobile_action_bar")}}),equation:te({key:"equation",closeParentMenu:!0,action:async e=>{var t;let{environment:i}=e;await(null===(t=i.NativeMobileActionBarStore)||void 0===t?void 0:t.clearNativeActionMenuAndRestoreSelectionIfNecessary()),q._W(i)}}),filePicker:te({key:"filePicker",closeParentMenu:!0,action:async e=>{var t;let{environment:i}=e;await(null===(t=i.NativeMobileActionBarStore)||void 0===t?void 0:t.clearNativeActionMenuAndRestoreSelectionIfNecessary()),q.vs(i)}}),indent:te({key:"indent",closeParentMenu:!1,action:e=>{let{environment:t}=e;q.O2(t)}}),unindent:te({key:"unindent",closeParentMenu:!1,action:e=>{let{environment:t}=e;q.$$(t)}}),moveDown:te({key:"moveDown",closeParentMenu:!1,action:e=>{let{environment:t}=e;q.rZ(t)}}),moveUp:te({key:"moveUp",closeParentMenu:!1,action:e=>{let{environment:t}=e;q.s0(t)}}),undo:te({key:"undo",closeParentMenu:!1,action:e=>{let{environment:t}=e;q.i2(t)}}),redo:te({key:"redo",closeParentMenu:!1,action:e=>{let{environment:t}=e;q.GH(t)}}),trash:te({key:"trash",closeParentMenu:!1,action:e=>{let{environment:t}=e;q.fn(t)}}),mention:te({key:"mention",closeParentMenu:!0,action:async e=>{var t;let{environment:i}=e;await(null===(t=i.NativeMobileActionBarStore)||void 0===t?void 0:t.clearNativeActionMenuAndRestoreSelectionIfNecessary()),q.Z3(i)}}),ai:te({key:"ai",closeParentMenu:!0,action:async e=>{var t;let{environment:i}=e;await(null===(t=i.NativeMobileActionBarStore)||void 0===t?void 0:t.clearNativeActionMenuAndRestoreSelectionIfNecessary()),q.QG(i)}}),link:te({key:"link",closeParentMenu:!0,action:async e=>{var t;let{environment:i}=e;await(null===(t=i.NativeMobileActionBarStore)||void 0===t?void 0:t.clearNativeActionMenuAndRestoreSelectionIfNecessary()),q.UF(i)}}),more:te({key:"more",closeParentMenu:!1,action:e=>{let{environment:t}=e;q.w1(t,void 0,void 0)}}),dismissKeyboard:te({key:"dismissKeyboard",closeParentMenu:!0,action:e=>{let{environment:t}=e}})},oe=(0,B.defineMessages)({templatesButtonTitle:{defaultMessage:"Choose a template...",id:"mobileActionBar.templateButtonTitle"},actionMenuInsertBlockTitle:{defaultMessage:"Insert Block",id:"mobileActionBar.actionMenuTitle.insertBlock"},actionMenuTurnIntoTitle:{defaultMessage:"Turn Into",id:"mobileActionBar.actionMenuTitle.turnInto"},actionMenuColorTitle:{defaultMessage:"Color",id:"mobileActionBar.actionMenuTitle.blockColor"},accessibilityInsert:{defaultMessage:"Add block",id:"mobileActionBar.accessibility.insertBlock",description:"Accessibility text, this will be read aloud by the screen reader"},accessibilityTurnInto:{defaultMessage:"Turn into block",id:"mobileActionBar.accessibility.turnInto",description:"Accessibility text, this will be read aloud by the screen reader"},accessibilityFilePicker:{defaultMessage:"Add image",id:"mobileActionBar.accessibility.filePicker",description:"Accessibility text, this will be read aloud by the screen reader"},accessibilityMention:{defaultMessage:"Add mention",id:"mobileActionBar.accessibility.mention",description:"Accessibility text, this will be read aloud by the screen reader"},accessibilityBlockColor:{defaultMessage:"Change block color",id:"mobileActionBar.accessibility.blockColor",description:"Accessibility text, this will be read aloud by the screen reader"},accessibilityTextFormatting:{defaultMessage:"Open text formatting menu",id:"mobileActionBar.accessibility.textFormatting",description:"Accessibility text, this will be read aloud by the screen reader"},accessibilityComment:{defaultMessage:"Add comment",id:"mobileActionBar.accessibility.comment",description:"Accessibility text, this will be read aloud by the screen reader"},accessibilityTrash:{defaultMessage:"Delete block",id:"mobileActionBar.accessibility.trash",description:"Accessibility text, this will be read aloud by the screen reader"},accessibilityIndent:{defaultMessage:"Indent block",id:"mobileActionBar.accessibility.indent",description:"Accessibility text, this will be read aloud by the screen reader"},accessibilityDedent:{defaultMessage:"Unindent block",id:"mobileActionBar.accessibility.unindent",description:"Accessibility text, this will be read aloud by the screen reader"},accessibilityMoveUp:{defaultMessage:"Move a block up",id:"mobileActionBar.accessibility.moveUp",description:"Accessibility text, this will be read aloud by the screen reader"},accessibilityMoveDown:{defaultMessage:"Move a block down",id:"mobileActionBar.accessibility.moveDown",description:"Accessibility text, this will be read aloud by the screen reader"},accessibilityUndo:{defaultMessage:"Undo edit",id:"mobileActionBar.accessibility.udno",description:"Accessibility text, this will be read aloud by the screen reader"},accessibilityRedo:{defaultMessage:"Redo edit",id:"mobileActionBar.accessibility.redo",description:"Accessibility text, this will be read aloud by the screen reader"},accessibilityMore:{defaultMessage:"More block actions",id:"mobileActionBar.accessibility.more",description:"Accessibility text, this will be read aloud by the screen reader"},accessibilityBold:{defaultMessage:"Bold",id:"mobileActionBar.accessibility.bold",description:"Accessibility text, this will be read aloud by the screen reader"},accessibilityItalics:{defaultMessage:"Italicize",id:"mobileActionBar.accessibility.italics",description:"Accessibility text, this will be read aloud by the screen reader"},accessibilityUnderline:{defaultMessage:"Underline",id:"mobileActionBar.accessibility.underline",description:"Accessibility text, this will be read aloud by the screen reader"},accessibilityStrikethrough:{defaultMessage:"Strikethrough",id:"mobileActionBar.accessibility.strikethrough",description:"Accessibility text, this will be read aloud by the screen reader"},accessibilityTextColor:{defaultMessage:"Text color",id:"mobileActionBar.accessibility.textColor",description:"Accessibility text, this will be read aloud by the screen reader"},accessibilityCode:{defaultMessage:"Code",id:"mobileActionBar.accessibility.code",description:"Accessibility text, this will be read aloud by the screen reader"},accessibilityLink:{defaultMessage:"Add link",id:"mobileActionBar.accessibility.link",description:"Accessibility text, this will be read aloud by the screen reader"},accessibilityEquation:{defaultMessage:"Add equation",id:"mobileActionBar.accessibility.equation",description:"Accessibility text, this will be read aloud by the screen reader"},accessibilityCloseTextFormattingMenu:{defaultMessage:"Close text formatting menu",id:"mobileActionBar.accessibility.close",description:"Accessibility text, this will be read aloud by the screen reader"},accessibilityDismissKeyboard:{defaultMessage:"End editing",id:"mobileActionBar.accessibility.endEditing",description:"Accessibility text, this will be read aloud by the screen reader"},accessibilityCloseActionMenu:{defaultMessage:"Close menu",id:"mobileActionBar.accessibility.closeMenu",description:"Accessibility text, this will be read aloud by the screen reader"},accessibilityAi:{defaultMessage:"AI Assist",id:"mobileActionBar.accessibility.ai",description:"Accessibility text, this will be read aloud by the screen reader"}}),ne={text:!1,to_do:!0,bulleted_list:!0,numbered_list:!0,toggle:!0,column:!1,transclusion_container:!1,callout:!1,quote:!1};function se(e){var t;const{onAction:i,fallbackRenderer:o,...n}=e,s=c(null===(t=(0,d.O7)().mobileNative)||void 0===t?void 0:t.api.renderMobileActionBar,n);return function(e,t,i,o){var n;const s=null===(n=(0,d.O7)().mobileNative)||void 0===n?void 0:n.componentEvents;(0,a.useEffect)((()=>{if(s&&o&&t)return s.addListener(e,t,i,o)}),[e,t,i,o,s])}("MobileActionBar",s,"onAction",i),!s&&o?a.createElement(a.Fragment,null,o()):null}class re extends l.Z{constructor(){super(...arguments),this.handleMobileActionBarBridgeEvent=e=>{const{action:t}=e;switch(t.type){case"nativeAction_hideKeyboard":break;case"nativeAction_setMenuType":this.handleSetMenuTypeAction(t);break;case"nativeAction_setSubMenuType":this.handleSetSubMenuTypeAction(t);break;case"webAction_generic":this.handleGenericWebAction(t);break;case"webAction_genericAction":this.handleActionRegistryAction(t)}},this.handleTextSelectionCompositeStoreChanged=()=>{if(!this.textSelectionCompositeStore.state)return;const{source:e}=this.textSelectionCompositeStore.state,{NativeMobileActionBarStore:t,device:i}=this.environment;"TextSelectionStore"!==e||null===(null==t?void 0:t.state.menuType)||i.isTablet||this.setCurrentMenuType(null,!0)},this.handleTextSelectionStoreChanged=()=>{if(!this.textSelectionPositionsStore.state)return;const{NativeMobileActionBarStore:e}=this.environment;e&&e.state.isSubMenuOverridden&&this.setCurrentSubMenuType(null,!1)},this.actionBarTextSelectionStore=this.createComputedStore((()=>{const e="editing"===H.default.state.mode&&H.default.state.multiSelection,t=this.props.stores.ignoreSelectionAreaStore.state.savedTextSelectionStoreState,i=t&&"editing"===t.mode&&t.multiSelection;return e||i||void 0}),!0),this.textSelectedBlocksStore=this.createComputedStore((()=>{var e;const t=this.actionBarTextSelectionStore.state;return t&&(null===(e=(0,V.tp)({multiSelection:t,focus:void 0,filterCommonAncestors:!1}))||void 0===e?void 0:e.stores)})),this.disableMentionCommentsStore=this.createComputedStore((()=>{const e=this.actionBarTextSelectionStore.state,t=Boolean(e&&(0,E.qS)(e)),i=this.props.currentBlockStore.getType(),o=this.props.currentBlockStore.getFormat();return{disableCommentAction:this.commentActionDisabled(i,o)||Boolean(this.renderStore.state.disableComment),disableLinkAction:!t,disableMentionAction:!t||this.mentionActionDisabled(i),disableEquationAction:!t}})),this.disableIndentStore=this.createComputedStore((()=>{const e=z.default.state.stores;return{disableIndent:!e.every(Z.nt),disableUnindent:!e.every(Z.gq)}})),this.disableUndoRedoStore=this.createComputedStore((()=>({disableUndo:!R.L0(),disableRedo:!R.AZ()}))),this.isEditingCurrentPageTitleStore=this.createComputedStore(D.JE),this.isEditingCollectionViewTitleStore=this.createComputedStore(D.VV),this.showTemplatesButtonStore=this.createComputedStore((()=>q.Tz({environment:this.environment,store:this.props.currentBlockStore}))),this.reactiveMemoizedNativeMenusStore=this.createComputedStore((()=>this.memoizedNativeMenus({blocks:z.default.state.stores,environment:this.environment}))),this.getCurrentActionBarSchema=this.createComputedStore(this.recomputeCurrentActionBarSchema.bind(this),!0,"getCurrentActionBarSchema"),this.buttonSectionsConfigStore=this.createComputedStore((()=>{var e;const{NativeMobileActionBarStore:t}=this.environment,i=Boolean(this.renderStore.state.disableAnnotation),o=t?t.state.menuType:null;var n=null;const s=this.showTemplatesButtonStore.state,r=!!t&&t.state.isSubMenuOverridden,a=this.shouldShowTextActions.state,l=t?t.state.subMenuType:null;r?n=l:a&&!i&&(n="textFormatting",null==t||t.update((e=>({...e,isSubMenuOverridden:!1,subMenuType:null}))));const c=!this.canTriggerTextActions.state,d=!this.canTriggerBlockActions.state,{disableCommentAction:u,disableLinkAction:h,disableMentionAction:m,disableEquationAction:p}=this.disableMentionCommentsStore.state,{disableIndent:b,disableUnindent:g}=this.disableIndentStore.state,y=this.isEditingCurrentPageTitleStore.state||this.isEditingCollectionViewTitleStore.state,{disableUndo:S,disableRedo:f}=this.disableUndoRedoStore.state,v=(0,U.GD)(this.environment,null===(e=this.pageContext)||void 0===e?void 0:e.publicEditModeStore.state),k=$.Z.state.isActive,T=y||k,A=this.reactiveMemoizedNativeMenusStore.state;return{selectedSubMenu:n,createAIAction:v,disableAIAction:T,disableBlockActions:d,disableCommentAction:u,disableMentionAction:m,selectedMenuType:o,disableTextFormatting:i,disableTextColorAction:C(A.textColor.sections),disableDeleteBlock:y,disableInsertBlockAction:C(A.insertBlock.sections),disableTurnIntoAction:C(A.turnInto.sections),shouldShowTemplatesButton:s,disableIndent:b,disableUnindent:g,disableUndo:S,disableRedo:f,disableTextActions:c,isEditingTitle:y,disableLinkAction:h,disableEquationAction:p,shouldShowTextActions:!0===a}})),this.templateButtonSectionsStore=this.createComputedStore((()=>({id:"mab.buttonSection.template",buttons:[g("mab.button.choose_template","webAction_generic",{content:{type:"text_and_icon",imageReference:{localImageIdentifier:"template"},text:O.default.formatMessage(oe.templatesButtonTitle)},apiRequestValue:{jsonPayload:v("showActionBarMenu",{actionBarMenuId:"template"})}})]}))),this.primaryActionButtonSectionsStore=this.createComputedStore((()=>{const{createAIAction:e,disableAIAction:t,disableBlockActions:i,disableCommentAction:o,disableMentionAction:n,selectedMenuType:s,disableInsertBlockAction:r,disableTurnIntoAction:a,disableTextFormatting:l,disableDeleteBlock:c}=this.buttonSectionsConfigStore.state;return function(e){const{createAIAction:t,disableAIAction:i,disableBlockActions:o,disableCommentAction:n,disableMentionAction:s,selectedMenuType:r,disableInsertBlockAction:a,disableTurnIntoAction:l,disableTextFormatting:c,disableDeleteBlock:d,accessibilityTexts:u}=e;return{id:"mab.buttonSection.main",buttons:[t?g("mab.button.ai","webAction_generic",{content:{type:"icon",imageReference:{sfProGlyphName:"sparkles",localImageIdentifier:"ai",imageTintColor:(0,h.J1)(h.FN.light.purple[500])},disabled:i,accessibilityText:u.ai},apiRequestValue:{jsonPayload:v("blockAction",{action:"ai"})}}):void 0,g("mab.button.insert","nativeAction_setMenuType",{content:{type:"icon",imageReference:{sfProGlyphName:"plus",localImageIdentifier:"insertBlock"},accessibilityText:u.insert,disabled:o||a,selected:"insertBlock"===r},apiRequestValue:{menuType:"insertBlock"}}),g("mab.button.turnInto","nativeAction_setMenuType",{content:{type:"icon",imageReference:{sfProGlyphName:"arrow.2.squarepath",localImageIdentifier:"turnInto"},disabled:o||l,selected:"turnInto"===r,accessibilityText:u.turnInto},apiRequestValue:{menuType:"turnInto"}}),g("mab.button.filePicker","webAction_generic",{content:{type:"icon",imageReference:{sfProGlyphName:"photo.on.rectangle.angled",localImageIdentifier:"filePicker"},disabled:o,accessibilityText:u.filePicker},apiRequestValue:{jsonPayload:v("blockAction",{action:"filePicker"})}}),g("mab.button.mention","webAction_generic",{content:{type:"icon",imageReference:{sfProGlyphName:"at",localImageIdentifier:"mention"},disabled:s,accessibilityText:u.mention},apiRequestValue:{jsonPayload:v("blockAction",{action:"mention"})}}),g("mab.button.comment","webAction_generic",{content:{type:"icon",imageReference:{sfProGlyphName:"bubble.left",localImageIdentifier:"comment"},disabled:n,accessibilityText:u.comment},apiRequestValue:{jsonPayload:v("blockAction",{action:"comment"},"mobile_action_bar")}}),g("bold.italic.underline","nativeAction_setSubMenuType",{content:{type:"icon",imageReference:{sfProGlyphName:"bold.italic.underline",localImageIdentifier:"boldItalicUnderline"},disabled:c,accessibilityText:u.textFormatting},apiRequestValue:{subMenuType:"textFormatting"}}),g("mab.button.delete","webAction_generic",{content:{type:"icon",imageReference:{sfProGlyphName:"trash",localImageIdentifier:"trash"},disabled:d,accessibilityText:u.trash},apiRequestValue:{jsonPayload:v("blockAction",{action:"trash"})}})].filter(m.$K)}}({createAIAction:e,disableAIAction:t,disableBlockActions:i,disableCommentAction:o,disableMentionAction:n,selectedMenuType:s,disableInsertBlockAction:r,disableTurnIntoAction:a,disableTextFormatting:l,disableDeleteBlock:c,accessibilityTexts:{insert:O.default.formatMessage(oe.accessibilityInsert),turnInto:O.default.formatMessage(oe.accessibilityTurnInto),filePicker:O.default.formatMessage(oe.accessibilityFilePicker),mention:O.default.formatMessage(oe.accessibilityMention),comment:O.default.formatMessage(oe.accessibilityComment),textFormatting:O.default.formatMessage(oe.accessibilityTextFormatting),trash:O.default.formatMessage(oe.accessibilityTrash),ai:O.default.formatMessage(oe.accessibilityAi)}})})),this.primaryActionButtonSectionsStoreV2=this.createComputedStore((()=>{const{createAIAction:e,disableAIAction:t,disableBlockActions:i,disableCommentAction:o,disableMentionAction:n,selectedMenuType:s,disableInsertBlockAction:r,disableTurnIntoAction:a,disableTextFormatting:l,disableDeleteBlock:c,disableUndo:d,disableIndent:u,disableUnindent:p}=this.buttonSectionsConfigStore.state,b=this.textSelectedBlocksStore.state;return function(e){const{createAIAction:t,disableAIAction:i,disableBlockActions:o,disableCommentAction:n,disableMentionAction:s,selectedMenuType:r,disableInsertBlockAction:a,disableTurnIntoAction:l,disableTextFormatting:c,disableDeleteBlock:d,disableUndo:u,disableIndent:p,disableUnindent:b,someBlockPrioritizesIndentation:y,supportsSectionAnimation:S,accessibilityTexts:f}=e,k=!(o||p&&b),T={ai:t?g("mab.button.ai","webAction_generic",{content:{type:"icon",imageReference:{sfProGlyphName:"sparkles",localImageIdentifier:"ai",imageTintColor:(0,h.J1)(h.FN.light.purple[500])},disabled:i,accessibilityText:f.ai},apiRequestValue:{jsonPayload:v("blockAction",{action:"ai"})}}):void 0,insert:g("mab.button.insert","nativeAction_setMenuType",{content:{type:"icon",imageReference:{sfProGlyphName:"plus",localImageIdentifier:"insertBlock"},accessibilityText:f.insert,disabled:o||a,selected:"insertBlock"===r},apiRequestValue:{menuType:"insertBlock"}}),turnInto:g("mab.button.turnInto","nativeAction_setMenuType",{content:{type:"icon",imageReference:{sfProGlyphName:"arrow.2.squarepath",localImageIdentifier:"turnInto"},disabled:o||l,selected:"turnInto"===r,accessibilityText:f.turnInto},apiRequestValue:{menuType:"turnInto"}}),filePicker:g("mab.button.filePicker","webAction_generic",{content:{type:"icon",imageReference:{sfProGlyphName:"photo.on.rectangle.angled",localImageIdentifier:"filePicker"},disabled:o,accessibilityText:f.filePicker},apiRequestValue:{jsonPayload:v("blockAction",{action:"filePicker"})}}),mention:g("mab.button.mention","webAction_generic",{content:{type:"icon",imageReference:{sfProGlyphName:"at",localImageIdentifier:"mention"},disabled:s,accessibilityText:f.mention},apiRequestValue:{jsonPayload:v("blockAction",{action:"mention"})}}),comment:g("mab.button.comment","webAction_generic",{content:{type:"icon",imageReference:{sfProGlyphName:"bubble.left",localImageIdentifier:"comment"},disabled:n,accessibilityText:f.comment},apiRequestValue:{jsonPayload:v("blockAction",{action:"comment"},"mobile_action_bar")}}),biu:g("bold.italic.underline","nativeAction_setSubMenuType",{content:{type:"icon",imageReference:{sfProGlyphName:"textformat",localImageIdentifier:"textFormat"},disabled:c,accessibilityText:f.textFormatting},apiRequestValue:{subMenuType:"textFormatting"}}),delete:g("mab.button.delete","webAction_generic",{content:{type:"icon",imageReference:{sfProGlyphName:"trash",localImageIdentifier:"trash"},disabled:d,accessibilityText:f.trash},apiRequestValue:{jsonPayload:v("blockAction",{action:"trash"})}}),undo:g("mab.button.undo","webAction_generic",{content:{type:"icon",imageReference:{sfProGlyphName:"arrow.uturn.backward",localImageIdentifier:"undo"},accessibilityText:f.undo,disabled:u},apiRequestValue:{jsonPayload:v("blockAction",{action:"undo"})}}),more:g("mab.button.more","webAction_generic",{content:{type:"icon",imageReference:{sfProGlyphName:"ellipsis",localImageIdentifier:"more"},accessibilityText:f.more},apiRequestValue:{jsonPayload:v("blockAction",{action:"more"})}}),indent:g("mab.button.indent","webAction_generic",{content:{type:"icon",imageReference:{sfProGlyphName:"decrease.indent",localImageIdentifier:"unindent"},accessibilityText:f.indent,disabled:o||b},apiRequestValue:{jsonPayload:v("blockAction",{action:"unindent"})}}),unindent:g("mab.button.unindent","webAction_generic",{content:{type:"icon",imageReference:{sfProGlyphName:"increase.indent",localImageIdentifier:"indent"},accessibilityText:f.unindent,disabled:o||p},apiRequestValue:{jsonPayload:v("blockAction",{action:"indent"})}}),moveUp:g("mab.button.moveUp","webAction_generic",{content:{type:"icon",imageReference:{sfProGlyphName:"arrow.up.to.line.alt",localImageIdentifier:"moveUp"},accessibilityText:f.moveUp,disabled:o},apiRequestValue:{jsonPayload:v("blockAction",{action:"moveUp"})}}),moveDown:g("mab.button.moveDown","webAction_generic",{content:{type:"icon",imageReference:{sfProGlyphName:"arrow.down.to.line.alt",localImageIdentifier:"moveDown"},accessibilityText:f.moveDown,disabled:o},apiRequestValue:{jsonPayload:v("blockAction",{action:"moveDown"})}})};if(k&&y){const e=[T.indent,T.unindent,T.moveUp,T.moveDown].filter(m.$K),t=[T.ai,T.insert,T.turnInto,T.filePicker,T.biu,T.comment,T.undo,T.mention,T.delete,T.more].filter(m.$K);return S?[{id:"mab.buttonSection.listPrioritized",buttons:e,skipSectionDivider:!0},{id:"mab.buttonSection.main",buttons:t}]:[{id:"mab.buttonSection.listPrioritized",buttons:e.concat(t),skipSectionDivider:!0}]}return[{id:"mab.buttonSection.main",buttons:[T.ai,T.insert,T.turnInto,T.filePicker,T.biu,T.comment,T.undo,T.mention,T.delete,T.indent,T.unindent,T.moveUp,T.moveDown,T.more].filter(m.$K)}]}({createAIAction:e,disableAIAction:t,disableBlockActions:i,disableCommentAction:o,disableMentionAction:n,selectedMenuType:s,disableInsertBlockAction:r,disableTurnIntoAction:a,disableTextFormatting:l,disableDeleteBlock:c,disableUndo:d,disableIndent:u,disableUnindent:p,someBlockPrioritizesIndentation:!!b&&b.some((e=>{const t=e.getType();return t&&ne[t]})),supportsSectionAnimation:this.environment.device.isIOS,accessibilityTexts:{insert:O.default.formatMessage(oe.accessibilityInsert),turnInto:O.default.formatMessage(oe.accessibilityTurnInto),filePicker:O.default.formatMessage(oe.accessibilityFilePicker),mention:O.default.formatMessage(oe.accessibilityMention),comment:O.default.formatMessage(oe.accessibilityComment),textFormatting:O.default.formatMessage(oe.accessibilityTextFormatting),trash:O.default.formatMessage(oe.accessibilityTrash),ai:O.default.formatMessage(oe.accessibilityAi),undo:O.default.formatMessage(oe.accessibilityUndo),more:O.default.formatMessage(oe.accessibilityMore),indent:O.default.formatMessage(oe.accessibilityIndent),unindent:O.default.formatMessage(oe.accessibilityDedent),moveUp:O.default.formatMessage(oe.accessibilityMoveUp),moveDown:O.default.formatMessage(oe.accessibilityMoveDown)}})})),this.listPrioritizedButtonSecionsStore=this.createComputedStore((()=>{const{disableBlockActions:e,disableIndent:t,disableUnindent:i}=this.buttonSectionsConfigStore.state;return I({id:"mab.list.prioritized",disableBlockActions:e,disableIndent:t,disableUnindent:i,shouldFadeIn:!1,includeUpAndDown:!1,accessibilityTexts:{indent:O.default.formatMessage(oe.accessibilityIndent),dedent:O.default.formatMessage(oe.accessibilityDedent),moveUp:O.default.formatMessage(oe.accessibilityMoveUp),moveDown:O.default.formatMessage(oe.accessibilityMoveDown)}})})),this.listDeprioritizedButtonSectionsStore=this.createComputedStore((()=>{const{disableBlockActions:e,disableIndent:t,disableUnindent:i}=this.buttonSectionsConfigStore.state;return I({id:"mab.list.deprioritized",disableBlockActions:e,disableIndent:t,disableUnindent:i,shouldFadeIn:!0,includeUpAndDown:!0,accessibilityTexts:{indent:O.default.formatMessage(oe.accessibilityIndent),dedent:O.default.formatMessage(oe.accessibilityDedent),moveUp:O.default.formatMessage(oe.accessibilityMoveUp),moveDown:O.default.formatMessage(oe.accessibilityMoveDown)}})})),this.blockButtonSectionsStore=this.createComputedStore((()=>{const{selectedMenuType:e,disableUndo:t,disableRedo:i,disableTextActions:o,disableTextColorAction:n}=this.buttonSectionsConfigStore.state;return function(e){const{disableUndo:t,disableRedo:i,disableTextActions:o,disableTextColorAction:n,textColorImageReference:s,selectedMenuType:r,accessibilityTexts:a}=e;return{id:"mab.buttonSection.block",buttons:[g("mab.button.undo","webAction_generic",{content:{type:"icon",imageReference:{sfProGlyphName:"arrow.uturn.backward",localImageIdentifier:"undo"},accessibilityText:a.undo,disabled:t},apiRequestValue:{jsonPayload:v("blockAction",{action:"undo"})}}),g("mab.button.redo","webAction_generic",{content:{type:"icon",imageReference:{sfProGlyphName:"arrow.uturn.forward",localImageIdentifier:"redo"},accessibilityText:a.redo,disabled:i},apiRequestValue:{jsonPayload:v("blockAction",{action:"redo"})}}),g("mab.button.textColor.native","nativeAction_setMenuType",{content:{type:"icon",imageReference:s,disabled:o||n,selected:"textColor"===r,accessibilityText:a.blockColor},apiRequestValue:{menuType:"textColor"}}),g("mab.button.more","webAction_generic",{content:{type:"icon",imageReference:{sfProGlyphName:"ellipsis",localImageIdentifier:"more"},accessibilityText:a.more},apiRequestValue:{jsonPayload:v("blockAction",{action:"more"})}})]}}({disableUndo:t,disableRedo:i,textColorImageReference:this.imageReferenceForBlockColor(this.textColorStore.state),disableTextActions:o,disableTextColorAction:n,selectedMenuType:e,accessibilityTexts:{undo:O.default.formatMessage(oe.accessibilityUndo),redo:O.default.formatMessage(oe.accessibilityRedo),blockColor:O.default.formatMessage(oe.accessibilityBlockColor),more:O.default.formatMessage(oe.accessibilityMore)}})})),this.moveUpAndDownButtonSectionsStore=this.createComputedStore((()=>{const{disableBlockActions:e}=this.buttonSectionsConfigStore.state;return{id:"mab.buttonSection.last",shouldFadeIn:!0,buttons:x({disableBlockActions:e,accessibilityTexts:{moveUp:O.default.formatMessage(oe.accessibilityMoveUp),moveDown:O.default.formatMessage(oe.accessibilityMoveDown)}})}})),this.textFormattingButtonSectionsStore=this.createComputedStore((()=>{const{createAIAction:e,disableAIAction:t,disableCommentAction:i,selectedMenuType:o,disableTextActions:n,disableTextColorAction:s,disableLinkAction:r,disableEquationAction:a}=this.buttonSectionsConfigStore.state;return function(e){const{createAIAction:t,disableAIAction:i,disableTextActions:o,boldSelected:n,italicSelected:s,underlineSelected:r,strikeSelected:a,codeSelected:l,linkSelected:c,equationSelected:d,selectedMenuType:u,disableTextColorAction:p,disableCommentAction:b,disableLinkAction:y,disableEquationAction:S,textColorImageReference:f,accessibilityTexts:k}=e;return{id:"mab.buttonSection.textFormatting",shouldFadeIn:!0,buttons:[g("mab.button.back","nativeAction_setSubMenuType",{content:{type:"icon",imageReference:{sfProGlyphName:"chevron.backward.2",localImageIdentifier:"back"},accessibilityText:k.close},apiRequestValue:{subMenuType:null}}),t?g("mab.button.ai","webAction_generic",{content:{type:"icon",imageReference:{sfProGlyphName:"sparkles",localImageIdentifier:"ai",imageTintColor:(0,h.J1)(h.FN.light.purple[500])},disabled:i,accessibilityText:k.ai},apiRequestValue:{jsonPayload:v("blockAction",{action:"ai"})}}):void 0,g("mab.button.bold","webAction_generic",{content:{type:"icon",imageReference:{sfProGlyphName:"bold",localImageIdentifier:"bold"},accessibilityText:k.bold,disabled:o,selected:n},apiRequestValue:{jsonPayload:v("blockAction",{action:"bold"})}}),g("mab.button.italic","webAction_generic",{content:{type:"icon",imageReference:{sfProGlyphName:"italic",localImageIdentifier:"italic"},disabled:o,selected:s,accessibilityText:k.italics},apiRequestValue:{jsonPayload:v("blockAction",{action:"italic"})}}),g("mab.button.underline","webAction_generic",{content:{type:"icon",imageReference:{sfProGlyphName:"underline",localImageIdentifier:"underline"},disabled:o,selected:r,accessibilityText:k.underline},apiRequestValue:{jsonPayload:v("blockAction",{action:"underline"})}}),g("mab.button.strikethrough","webAction_generic",{content:{type:"icon",imageReference:{sfProGlyphName:"strikethrough",localImageIdentifier:"strikethrough"},disabled:o,selected:a,accessibilityText:k.strikethrough},apiRequestValue:{jsonPayload:v("blockAction",{action:"strikethrough"})}}),g("mab.button.textFormatting.textSelectionColor.native","nativeAction_setMenuType",{content:{type:"icon",imageReference:f,disabled:o||p,selected:"textSelectionColor"===u,accessibilityText:k.textColor},apiRequestValue:{menuType:"textSelectionColor"}}),g("mab.button.textFormatting.comment","webAction_generic",{content:{type:"icon",imageReference:{sfProGlyphName:"bubble.left",localImageIdentifier:"comment"},disabled:o||b,accessibilityText:k.comment},apiRequestValue:{jsonPayload:v("blockAction",{action:"comment"},"mobile_text_formatting_menu")}}),g("mab.button.link","webAction_generic",{content:{type:"icon",imageReference:{sfProGlyphName:"link",localImageIdentifier:"link"},accessibilityText:k.link,disabled:o||y,selected:c},apiRequestValue:{jsonPayload:v("blockAction",{action:"link"})}}),g("mab.button.code","webAction_generic",{content:{type:"icon",imageReference:{sfProGlyphName:"chevron.left.slash.chevron.right",localImageIdentifier:"code"},accessibilityText:k.code,disabled:o,selected:l},apiRequestValue:{jsonPayload:v("blockAction",{action:"code"})}}),g("mab.button.equation","webAction_generic",{content:{type:"icon",imageReference:{sfProGlyphName:"x.squareroot",localImageIdentifier:"equation"},accessibilityText:k.equation,disabled:o||S,selected:d},apiRequestValue:{jsonPayload:v("blockAction",{action:"equation"})}}),g("mab.button.cancel","nativeAction_setSubMenuType",{content:{type:"icon",imageReference:{sfProGlyphName:"xmark.circle.fill",localImageIdentifier:"cancel",imageTintColor:"#72706B64"},accessibilityText:k.close},apiRequestValue:{subMenuType:null}})].filter(m.$K)}}({createAIAction:e,disableAIAction:t,disableTextActions:n,disableCommentAction:i,disableLinkAction:r,disableEquationAction:a,selectedMenuType:o,disableTextColorAction:s,textColorImageReference:this.imageReferenceForBlockColor(this.textSelectionColorStore.state),accessibilityTexts:{bold:O.default.formatMessage(oe.accessibilityBold),italics:O.default.formatMessage(oe.accessibilityItalics),underline:O.default.formatMessage(oe.accessibilityUnderline),strikethrough:O.default.formatMessage(oe.accessibilityStrikethrough),textColor:O.default.formatMessage(oe.accessibilityTextColor),comment:O.default.formatMessage(oe.accessibilityComment),code:O.default.formatMessage(oe.accessibilityCode),link:O.default.formatMessage(oe.accessibilityLink),equation:O.default.formatMessage(oe.accessibilityEquation),close:O.default.formatMessage(oe.accessibilityCloseTextFormattingMenu),ai:O.default.formatMessage(oe.accessibilityAi)},...this.textFormattingSelectionStore.state})})),this.textFormattingButtonSectionsStoreV2=this.createComputedStore((()=>{const{disableCommentAction:e,selectedMenuType:t,disableTextActions:i,disableTextColorAction:o,disableLinkAction:n,disableEquationAction:s,disableBlockActions:r,disableTurnIntoAction:a,disableAIAction:l,createAIAction:c,shouldShowTextActions:d}=this.buttonSectionsConfigStore.state;return function(e){const{disableTextActions:t,boldSelected:i,italicSelected:o,underlineSelected:n,strikeSelected:s,codeSelected:r,linkSelected:a,equationSelected:l,selectedMenuType:c,disableTextColorAction:d,disableCommentAction:u,disableLinkAction:p,disableEquationAction:b,textColorImageReference:y,accessibilityTexts:S,disableBlockActions:f,disableTurnIntoAction:k,disableAIAction:T,createAIAction:A,shouldShowTextActions:M}=e,C=M?"textSelectionColor":"textColor",x={back:g("mab.button.back","nativeAction_setSubMenuType",{content:{type:"icon",imageReference:{sfProGlyphName:"chevron.backward.2",localImageIdentifier:"back"},accessibilityText:S.close},apiRequestValue:{subMenuType:null}}),bold:g("mab.button.bold","webAction_generic",{content:{type:"icon",imageReference:{sfProGlyphName:"bold",localImageIdentifier:"bold"},accessibilityText:S.bold,disabled:t,selected:i},apiRequestValue:{jsonPayload:v("blockAction",{action:"bold"})}}),italic:g("mab.button.italic","webAction_generic",{content:{type:"icon",imageReference:{sfProGlyphName:"italic",localImageIdentifier:"italic"},disabled:t,selected:o,accessibilityText:S.italics},apiRequestValue:{jsonPayload:v("blockAction",{action:"italic"})}}),underline:g("mab.button.underline","webAction_generic",{content:{type:"icon",imageReference:{sfProGlyphName:"underline",localImageIdentifier:"underline"},disabled:t,selected:n,accessibilityText:S.underline},apiRequestValue:{jsonPayload:v("blockAction",{action:"underline"})}}),strikethrough:g("mab.button.strikethrough","webAction_generic",{content:{type:"icon",imageReference:{sfProGlyphName:"strikethrough",localImageIdentifier:"strikethrough"},disabled:t,selected:s,accessibilityText:S.strikethrough},apiRequestValue:{jsonPayload:v("blockAction",{action:"strikethrough"})}}),color:g("mab.button.textFormatting.textSelectionColor.native","nativeAction_setMenuType",{content:{type:"icon",imageReference:y,disabled:t||d,selected:c===C,accessibilityText:S.textColor},apiRequestValue:{menuType:C}}),comment:g("mab.button.textFormatting.comment","webAction_generic",{content:{type:"icon",imageReference:{sfProGlyphName:"bubble.left",localImageIdentifier:"comment"},disabled:t||u,accessibilityText:S.comment},apiRequestValue:{jsonPayload:v("blockAction",{action:"comment"},"mobile_text_formatting_menu")}}),link:g("mab.button.link","webAction_generic",{content:{type:"icon",imageReference:{sfProGlyphName:"link",localImageIdentifier:"link"},accessibilityText:S.link,disabled:t||p,selected:a},apiRequestValue:{jsonPayload:v("blockAction",{action:"link"})}}),code:g("mab.button.code","webAction_generic",{content:{type:"icon",imageReference:{sfProGlyphName:"chevron.left.slash.chevron.right",localImageIdentifier:"code"},accessibilityText:S.code,disabled:t,selected:r},apiRequestValue:{jsonPayload:v("blockAction",{action:"code"})}}),equation:g("mab.button.equation","webAction_generic",{content:{type:"icon",imageReference:{sfProGlyphName:"x.squareroot",localImageIdentifier:"equation"},accessibilityText:S.equation,disabled:t||b,selected:l},apiRequestValue:{jsonPayload:v("blockAction",{action:"equation"})}}),cancel:g("mab.button.cancel","nativeAction_setSubMenuType",{content:{type:"icon",imageReference:{sfProGlyphName:"xmark.circle.fill",localImageIdentifier:"cancel",imageTintColor:"#72706B64"},accessibilityText:S.close},apiRequestValue:{subMenuType:null}}),turnInto:g("mab.button.turnInto","nativeAction_setMenuType",{content:{type:"icon",imageReference:{sfProGlyphName:"arrow.2.squarepath",localImageIdentifier:"turnInto"},disabled:f||k,selected:"turnInto"===c,accessibilityText:S.turnInto},apiRequestValue:{menuType:"turnInto"}}),ai:A?g("mab.button.ai","webAction_generic",{content:{type:"icon",imageReference:{sfProGlyphName:"sparkles",localImageIdentifier:"ai",imageTintColor:(0,h.J1)(h.FN.light.purple[500])},disabled:T,accessibilityText:S.ai},apiRequestValue:{jsonPayload:v("blockAction",{action:"ai"})}}):void 0};let I;return I=M?[x.back,x.turnInto,x.ai,x.color,x.comment,x.bold,x.italic,x.underline,x.strikethrough,x.link,x.code,x.equation].filter(m.$K):[x.back,x.color,x.bold,x.italic,x.underline,x.strikethrough,x.link,x.code,x.equation],{id:"mab.buttonSection.textFormatting",shouldFadeIn:!0,buttons:I}}({disableTextActions:i,disableCommentAction:e,disableLinkAction:n,disableEquationAction:s,selectedMenuType:t,disableTextColorAction:o,disableBlockActions:r,disableTurnIntoAction:a,disableAIAction:l,createAIAction:c,shouldShowTextActions:d,textColorImageReference:this.imageReferenceForBlockColor(this.textSelectionColorStore.state),accessibilityTexts:{bold:O.default.formatMessage(oe.accessibilityBold),italics:O.default.formatMessage(oe.accessibilityItalics),underline:O.default.formatMessage(oe.accessibilityUnderline),strikethrough:O.default.formatMessage(oe.accessibilityStrikethrough),textColor:O.default.formatMessage(oe.accessibilityTextColor),comment:O.default.formatMessage(oe.accessibilityComment),code:O.default.formatMessage(oe.accessibilityCode),link:O.default.formatMessage(oe.accessibilityLink),equation:O.default.formatMessage(oe.accessibilityEquation),close:O.default.formatMessage(oe.accessibilityCloseTextFormattingMenu),turnInto:O.default.formatMessage(oe.accessibilityTurnInto),ai:O.default.formatMessage(oe.accessibilityAi)},...this.textFormattingSelectionStore.state})})),this.mainButtonSectionsStore=this.createComputedStore((()=>{const{shouldShowTemplatesButton:e,isEditingTitle:t}=this.buttonSectionsConfigStore.state;var i;if(e)i=[this.templateButtonSectionsStore.state];else{const e={primary:this.primaryActionButtonSectionsStore,listPrioritized:this.listPrioritizedButtonSecionsStore,listDeprioritized:this.listDeprioritizedButtonSectionsStore,block:this.blockButtonSectionsStore,moveUpAndDown:this.moveUpAndDownButtonSectionsStore},o=this.textSelectedBlocksStore.state,n=o&&o.some((e=>{const t=e.getType();return t&&ne[t]}));i=e.listPrioritized.state&&n?[e.listPrioritized.state,e.primary.state,e.block.state,e.moveUpAndDown.state]:e.listDeprioritized.state&&o&&o.every((e=>Z.nt(e)||Z.gq(e)))?[e.primary.state,e.block.state,e.listDeprioritized.state]:t?[e.primary.state,e.block.state]:[e.primary.state,e.block.state,e.moveUpAndDown.state]}return i})),this.mainButtonSectionsStoreV2=this.createComputedStore((()=>{const{shouldShowTemplatesButton:e}=this.buttonSectionsConfigStore.state;return e?[this.templateButtonSectionsStore.state]:this.primaryActionButtonSectionsStoreV2.state})),this.textSelectionPositionsStore=this.createComputedStore((()=>{const e=this.textSelectionCompositeStore.state;if(!e)return;const{source:t,...i}=e;return i}),!0),this.textSelectionCompositeStore=this.createComputedStore((()=>{const e=(e,t)=>{if(!e||"editing"!==e.mode)return;const{multiSelection:i}=e;return{startRecord:i.start.store.pointer,startIndex:i.start.index,endRecord:i.end.store.pointer,endIndex:i.end.index,source:t}};return e(H.default.state,"TextSelectionStore")||e(this.props.stores.ignoreSelectionAreaStore.state.savedTextSelectionStoreState,"IgnoreSelectionAreaStore")}),!0),this.renderStore=this.createComputedStore((()=>{var e;const t=q.$3(this.environment,this.props.currentBlockStore,null===(e=this.pageContext)||void 0===e?void 0:e.publicEditModeStore.state);if(!t){const e=this.environment.NativeMobileActionBarStore;null!==(null==e?void 0:e.state.menuType)&&r().delay((()=>{var e;q.$3(this.environment,this.props.currentBlockStore,null===(e=this.pageContext)||void 0===e?void 0:e.publicEditModeStore.state)||this.setCurrentMenuType(null,!1)}),500),null!==(null==e?void 0:e.state.subMenuType)&&r().delay((()=>{var e;q.$3(this.environment,this.props.currentBlockStore,null===(e=this.pageContext)||void 0===e?void 0:e.publicEditModeStore.state)||this.setCurrentSubMenuType(null,!1)}),500)}return t})),this.shouldShowTextActions=this.createComputedStore((()=>q.oQ(this.props.stores.ignoreSelectionAreaStore,this.environment.TextSelectionCompositionStore))),this.canTriggerBlockActions=this.createComputedStore((()=>q.Bo(this.pageContext&&this.pageContext.publicEditModeStore.state))),this.canTriggerTextActions=this.createComputedStore((()=>q.eQ(this.pageContext&&this.pageContext.publicEditModeStore.state,this.props.currentBlockStore))),this.memoizedNativeMenus=r().memoize((e=>{const{blocks:t,environment:i}=e;return o={environment:i,blocks:t,publicEditMode:void 0},{insertBlock:ee({type:"insertBlock",actionSections:J.L1(Y.vC.state.insertActions,o),context:o,closeParentMenu:!0}),turnInto:ee({type:"turnInto",actionSections:J.L1([Y.gH],o),context:o,closeParentMenu:!0}),textColor:ee({type:"textColor",actionSections:J.L1([Y.rz,Y.Vm],o),context:o,closeParentMenu:!0}),textSelectionColor:ee({type:"textSelectionColor",actionSections:J.L1([Y.b4,Y.Sw],o),context:o,closeParentMenu:!0})};var o}),(e=>{let{blocks:t,environment:i}=e;const o=t.map((e=>e.key)).join(",");return`${i.key}-${o}`})),this.textFormattingSelectionStore=this.createComputedStore((()=>{let e;e="editing"===H.default.state.mode?(0,G.k2)([w.GK.Bold,w.GK.Italic,w.GK.Underline,w.GK.Strike,w.GK.Code,w.GK.Link,w.GK.Equation,w.GK.Highlight],H.default.state.multiSelection,H.default.state.forceExtendAnnotations):{};const t=e[w.GK.Highlight];return{boldSelected:Boolean(e[w.GK.Bold]),italicSelected:Boolean(Boolean(e[w.GK.Italic])),underlineSelected:Boolean(Boolean(e[w.GK.Underline])),strikeSelected:Boolean(Boolean(e[w.GK.Strike])),codeSelected:Boolean(e[w.GK.Code]),linkSelected:Boolean(e[w.GK.Link]),equationSelected:Boolean(e[w.GK.Equation]),highlightColor:t?(0,w.zI)(t):void 0}})),this.textSelectionColorStore=this.createComputedStore((()=>{const{NativeMobileActionBarStore:e}=this.environment,t=e&&null!==e.state.menuType?this.props.stores.ignoreSelectionAreaStore.state.savedTextSelectionStoreState:void 0;if(!t)return this.textFormattingSelectionStore.state.highlightColor;const i="editing"===t.mode&&(0,G.a6)("h",t.multiSelection,t.forceExtendAnnotations);return i?(0,w.zI)(i):void 0})),this.textColorStore=this.createComputedStore((()=>z.default.state.stores.length>0?z.default.state.stores[0].getFormat().block_color:void 0))}didMount(){this.textSelectionCompositeStore.addListener(this.handleTextSelectionCompositeStoreChanged),this.textSelectionPositionsStore.addListener(this.handleTextSelectionStoreChanged)}willUnmount(){this.textSelectionCompositeStore.removeListener(this.handleTextSelectionCompositeStoreChanged),this.textSelectionPositionsStore.removeListener(this.handleTextSelectionStoreChanged),this.props.renderApi&&this.props.renderApi({type:"unmount",id:""})}renderComponent(){const{fallbackRenderer:e,stores:t}=this.props;return n()(se,{isOpen:this.renderStore.state.shouldShow,canShow:this.renderStore.state.canShowNativeBar,isEmpty:this.renderStore.state.isEmpty,schema:this.getCurrentActionBarSchema.state,onAction:this.handleMobileActionBarBridgeEvent,fallbackRenderer:e&&(()=>e(t))})}recomputeCurrentActionBarSchema(){const{selectedMenuType:e,selectedSubMenu:t}=this.buttonSectionsConfigStore.state,{shouldShow:i}=this.renderStore.state,o=i&&this.isInMobileActionBarReorderingExperiment()?this.mainButtonSectionsStoreV2.state:this.mainButtonSectionsStore.state,n=i&&this.isInMobileActionBarReorderingExperiment()?[this.textFormattingButtonSectionsStoreV2.state]:[this.textFormattingButtonSectionsStore.state],s=this.reactiveMemoizedNativeMenusStore.state;return function(e){const{selectedMenu:t,selectedSubMenu:i,nativeMenus:o,buttonSections:n,nativeSubMenus:s,accessibilityTexts:r}=e;return{nativeMenus:o,nativeSubMenus:s,state:{buttonSections:n,selectedMenu:t,selectedSubMenu:i,dismissKeyboardButton:null!==t?g("mab.dismissKeyboard","nativeAction_setMenuType",{content:{type:"icon",imageReference:{sfProGlyphName:"xmark.circle.fill",localImageIdentifier:"cancel",imageTintColor:"#72706B64"},accessibilityText:r.closeActionMenu},apiRequestValue:{menuType:null}}):g("mab.dismissKeyboard","webAction_generic",{content:{type:"icon",imageReference:{sfProGlyphName:"keyboard.chevron.compact.down",localImageIdentifier:"keyboardDown"},accessibilityText:r.dismissKeyboard},apiRequestValue:{jsonPayload:v("blockAction",{action:"dismissKeyboard"})}}),mutatedNativeMenus:{},localizedMessages:{}}}}({selectedMenu:e,selectedSubMenu:t,nativeMenus:{textColor:{id:"textColor",title:O.default.formatMessage(oe.actionMenuColorTitle),sections:s.textColor.sections},textSelectionColor:{id:"textSelectionColor",title:O.default.formatMessage(oe.actionMenuColorTitle),sections:s.textSelectionColor.sections},insertBlock:{id:"insertBlock",title:O.default.formatMessage(oe.actionMenuInsertBlockTitle),sections:s.insertBlock.sections},turnInto:{id:"turnInto",title:O.default.formatMessage(oe.actionMenuTurnIntoTitle),sections:s.turnInto.sections}},nativeSubMenus:{textFormatting:n},buttonSections:o,accessibilityTexts:{dismissKeyboard:O.default.formatMessage(oe.accessibilityDismissKeyboard),closeActionMenu:O.default.formatMessage(oe.accessibilityCloseActionMenu)}})}isInMobileActionBarReorderingExperiment(){return"on"===j.default.getEligibleGroup({experimentId:"mobile_action_bar_ordering_v2",defaultGroup:"control"})}commentActionDisabled(e,t){return!(!e||!(0,u._T)(e,t))}mentionActionDisabled(e){return!(!e||!(0,u.lQ)(e))}handleSetMenuTypeAction(e){const t=function(e){if("nativeAction_setMenuType"!==e.type)return new M(A.InvalidActionType,void 0);const t=e.apiRequestValue;if(!t||!("menuType"in t))return new M(A.MissingPayload,void 0);const i=b.object({required:{menuType:b.literals(...y,null)},optional:{}}),o=(0,p.Gu)(i,t);return o?new M(A.InvalidRequestType,JSON.stringify(o)):t.menuType}(e);if(t instanceof M)return void console.error(JSON.stringify(t));if((this.environment.NativeMobileActionBarStore?this.environment.NativeMobileActionBarStore.state.menuType:null)===t)this.setCurrentMenuType(null,!0);else switch(this.setCurrentMenuType(t,!0),t){case"insertBlock":q.Oh(this.environment,"insert");break;case"turnInto":q.Oh(this.environment,"turn_into");break;case"textColor":q.Oh(this.environment,"color","mobile_action_bar");break;case"textSelectionColor":q.Oh(this.environment,"color","mobile_text_formatting_menu")}}handleSetSubMenuTypeAction(e){const t=function(e){if("nativeAction_setSubMenuType"!==e.type)return new M(A.InvalidActionType,void 0);const t=e.apiRequestValue;if(!t||!("subMenuType"in t))return new M(A.MissingPayload,void 0);const i=b.object({required:{subMenuType:b.literals(...S,null)},optional:{}}),o=(0,p.Gu)(i,t);return o?new M(A.InvalidRequestType,JSON.stringify(o)):t.subMenuType}(e);t instanceof M?console.error(JSON.stringify(t)):this.setCurrentSubMenuType(t,!0)}handleGenericWebAction(e){const t=function(e){if("webAction_generic"!==e.type)return new M(A.InvalidActionType,void 0);const t=e.apiRequestValue;if(!t||!("jsonPayload"in t))return new M(A.MissingPayload,void 0);const i=JSON.parse(t.jsonPayload),o=b.object({required:{type:b.literals(...T)},optional:{}}),n=(0,p.Gu)(o,i);if(n)return new M(A.InvalidRequestType,JSON.stringify(n));const s=i,r=k[s.type],a=(0,p.Gu)(r,s);return a?new M(A.InvalidData,JSON.stringify(a)):s}(e);if(t instanceof M)console.error(JSON.stringify(t));else switch(t.type){case"blockAction":if("dismissKeyboard"===t.data.action){this.handleDismissKeyboard();break}const e=ie[t.data.action];if(!e)break;const i=e.action;if(i){const{mainEditorCurrentBlockStore:t}=W.default.state;if(!t)break;const{device:o}=this.environment;e.closeParentMenu&&!o.isTablet&&this.setCurrentMenuType(null,!0),i({environment:this.environment,blocks:[t],publicEditMode:void 0})}switch(t.data.action){case"comment":P.YOV(this.environment,{itemName:"comment",from:t.from})}break;case"showActionBarMenu":switch(t.data.actionBarMenuId){case"insertBlock":this.handleInsert();break;case"textColor":this.handleTextColor();break;case"turnInto":this.handleTurnInto();break;case"template":this.handleTemplate()}}}handleActionRegistryAction(e){var t,i;const o=null===(t=e.apiRequestValue)||void 0===t?void 0:t.menuType,n=null===(i=e.apiRequestValue)||void 0===i?void 0:i.actionId;if(!o||!n)return;const s=this.memoizedNativeMenus({environment:this.environment,blocks:z.default.state.stores})[o].actions[n];if(!s)return;const r=s.action;r&&(s.closeParentMenu&&this.setCurrentMenuType(null,!0),r({environment:this.environment,blocks:z.default.state.stores,publicEditMode:void 0}));const a=z.default.state.stores[0];if(a){const e=a.getType(),t=a.getFormat();P.dhV(this.environment,{analyticsName:s.analyticsName,from:"slash_menu",block_id:a.id,block_type:e,is_toggleable:e?(0,L._A)(e,t):void 0,slash_menu_filter_length:0,slash_menu_section:`Mobile Action Bar ${o}`})}}handleDismissKeyboard(){N.ZH(this.environment),F.MO(),this.props.stores.store.update((e=>({...e,isInsertOpen:!1}))),this.setCurrentMenuType(null,!1),this.setCurrentSubMenuType(null,!1),q.Oh(this.environment,"hide_keyboard"),_.sD()}imageReferenceForBlockColor(e){let t="textColor";const i=h.E_.find((t=>t===e));let o;"default"===e||i&&(i.includes("background")?(o="background",t="textBackgroundColor"):o="color");const n=o&&i?(0,h.fi)(i,this.theme)[o]:void 0;return{localImageIdentifier:t,imageTintColor:n?(0,h.J1)(n):void 0}}handleInsert(){this.props.stores.store.update((e=>({...e,isInsertOpen:!0}))),q.Oh(this.environment,"insert")}handleTurnInto(){this.props.stores.store.update((e=>({...e,isTurnIntoOpen:!0}))),q.Oh(this.environment,"turn_into")}handleTemplate(){N.ZH(this.environment),_.sD(),this.props.stores.store.update((e=>({...e,isTemplatesOpen:!0}))),q.Oh(this.environment,"templates")}handleTextColor(){this.props.stores.store.update((e=>({...e,isColorOpen:!0}))),q.Oh(this.environment,"color")}setCurrentMenuType(e,t){var i;null===(i=this.environment.NativeMobileActionBarStore)||void 0===i||i.update((i=>({...i,menuType:e,shouldRestoreSelectionForMenu:t})))}setCurrentSubMenuType(e,t){const{NativeMobileActionBarStore:i}=this.environment;null==i||i.update((i=>({...i,isSubMenuOverridden:t,subMenuType:e}))),null!==e&&q.Oh(this.environment,e)}}re.displayName="NativeMobileActionBar";const ae=(0,B.injectIntl)(re)},72653:(e,t,i)=>{i.d(t,{Z:()=>a});var o=i(14577),n=i(59488),s=i(69454),r=i(55320);const a=new o.Z((()=>{const{phase:e}=s.Z.state;if(r.default.state.open)return!0;return(0,n.Y)("supportsFixedSizeWebView")&&!s.Z.state.shouldResizeWebView||e===s.i.hidden||e===s.i.willHide}),{debugName:"MobileBottomBarStore"})}}]);